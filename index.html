<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROD-TORG BARNAUL - –ú–∞–≥–∞–∑–∏–Ω –¥–ª—è —Å–≤–æ–∏—Ö</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* –°–¢–ò–õ–ò - –°–û–•–†–ê–ù–ò–õ–ò –í–ê–®–£ –°–¢–†–£–ö–¢–£–†–£ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2c5aa0; --secondary: #e74c3c; --accent: #27ae60;
            --light: #f8f9fa; --dark: #2c3e50; --gray: #6c757d; --border: #e9ecef;
            --bg-gradient: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6; color: var(--dark);
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh; scroll-behavior: smooth;
        }
        
        /* –õ–û–ì–ò–ù */
        .login-modal {
            display: flex; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.8);
            z-index: 10001; align-items: center; justify-content: center;
        }
        .login-content {
            background: white; padding: 40px; border-radius: 20px;
            width: 90%; max-width: 400px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        .login-tabs { display: flex; margin-bottom: 30px; border-bottom: 2px solid var(--border); }
        .login-tab {
            flex: 1; padding: 15px; background: none; border: none;
            font-size: 16px; font-weight: 600; cursor: pointer;
            color: var(--gray); transition: all 0.3s ease;
        }
        .login-tab.active { color: var(--primary); border-bottom: 3px solid var(--primary); }
        .login-form { display: none; }
        .login-form.active { display: block; }
        
        /* –ö–û–ù–°–¢–†–£–ö–¢–û–† */
        .constructor-toolbar {
            position: fixed; bottom: 20px; right: 20px; z-index: 10000;
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            border-radius: 50px; box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease; overflow: hidden;
        }
        .constructor-toggle {
            width: 50px; height: 50px;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            border-radius: 50%; display: flex; align-items: center;
            justify-content: center; color: white; cursor: pointer;
            transition: all 0.3s ease; font-size: 1.2rem;
        }
        .constructor-toolbar.expanded { border-radius: 25px; padding: 15px; }
        .constructor-toolbar.expanded .constructor-toggle { margin-bottom: 15px; }
        #editButtons { display: flex; flex-direction: column; gap: 8px; }
        .edit-btn {
            background: rgba(255, 255, 255, 0.9); border: 1px solid var(--border);
            color: var(--dark); padding: 8px 15px; border-radius: 20px;
            cursor: pointer; font-size: 12px; transition: all 0.3s ease;
            white-space: nowrap;
        }
        .edit-btn:hover { background: var(--primary); color: white; transform: translateX(-5px); }
        
        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        header {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1); position: fixed;
            width: 100%; top: 0; z-index: 1000;
        }
        .header-top {
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            color: white; padding: 8px 0; font-size: 14px;
        }
        .header-main { padding: 15px 0; }
        .header-main .container {
            display: flex; justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 28px; font-weight: bold; color: var(--primary);
            text-decoration: none; background: linear-gradient(135deg, var(--primary), #1a3a6b);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .categories-section {
            padding: 100px 0 50px; background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px); margin: 20px; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .section-title {
            text-align: center; font-size: 2rem; margin-bottom: 40px;
            color: var(--dark); position: relative; font-weight: 700;
        }
        .section-title::after {
            content: ''; display: block; width: 80px; height: 4px;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            margin: 15px auto; border-radius: 2px;
        }
        .categories-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px; margin-bottom: 40px;
        }
        .category-card {
            border-radius: 15px; padding: 40px 20px; text-align: center;
            text-decoration: none; color: white; transition: all 0.4s ease;
            border: none; position: relative; overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2); min-height: 200px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: center; cursor: pointer;
        }
        .category-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }
        .category-icon {
            font-size: 3rem; margin-bottom: 20px; display: block;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
            position: relative; z-index: 2;
        }
        
        /* –¢–û–í–ê–†–´ */
        .products-section {
            padding: 80px 0; background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px); margin: 40px 20px 0;
            border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .products-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }
        .product-card {
            background: white; border-radius: 15px; overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;
            position: relative;
        }
        .product-card:hover { transform: translateY(-8px); box-shadow: 0 15px 35px rgba(0,0,0,0.15); }
        .product-image {
            width: 100%; height: 200px; object-fit: cover;
            object-position: center; transition: transform 0.3s ease;
            cursor: pointer; background-color: #f8f9fa;
        }
        .product-card:hover .product-image { transform: scale(1.05); }
        .product-info { padding: 20px; }
        .product-name {
            font-size: 1.2rem; font-weight: 700; margin-bottom: 10px;
            color: var(--dark); line-height: 1.3; cursor: pointer;
        }
        .product-name:hover { color: var(--primary); }
        
        /* –û–°–¢–ê–õ–¨–ù–´–ï –°–¢–ò–õ–ò –°–û–•–†–ê–ù–Ø–ï–ú */
        .btn { padding: 12px 25px; border: none; border-radius: 8px;
            cursor: pointer; font-weight: 600; display: inline-flex;
            align-items: center; gap: 8px; transition: all 0.3s ease;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--accent); color: white; }
        .btn-danger { background: var(--secondary); color: white; }
        .notification {
            position: fixed; top: 100px; right: 20px;
            background: var(--accent); color: white; padding: 15px 25px;
            border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –ú–û–ë–ò–õ–¨–ù–ê–Ø –ê–î–ê–ü–¢–ê–¶–ò–Ø */
        @media (max-width: 768px) {
            .header-main .container { flex-direction: column; gap: 15px; }
            .categories-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
            .categories-section, .products-section { margin: 0 10px; padding: 40px 20px; }
        }
    </style>
</head>
<body>
    <!-- –§–û–†–ú–ê –õ–û–ì–ò–ù–ê -->
    <div class="login-modal" id="loginModal">
        <div class="login-content">
            <h2 style="margin-bottom: 30px; color: var(--primary);">üîê PROD-TORG BARNAUL</h2>
            
            <div class="login-tabs">
                <button class="login-tab active" onclick="switchTab('customer')">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</button>
                <button class="login-tab" onclick="switchTab('admin')">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
            </div>

            <div class="login-form active" id="customerForm">
                <div class="form-group">
                    <label>üë§ –í–∞—à–µ –∏–º—è:</label>
                    <input type="text" class="form-control" id="customerName" placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤" required>
                </div>
                <div class="form-group">
                    <label>üìû –¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" class="form-control" id="customerPhone" 
                           placeholder="+7 (923) 753-36-06" required>
                </div>
                <button class="btn btn-primary" onclick="loginAsCustomer()" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
                </button>
                <p style="margin-top: 15px; color: var(--gray); font-size: 12px;">
                    üîí –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤
                </p>
            </div>

            <div class="login-form" id="adminForm">
                <div class="form-group">
                    <label>üëë –õ–æ–≥–∏–Ω:</label>
                    <input type="text" class="form-control" id="adminLogin" placeholder="admin">
                </div>
                <div class="form-group">
                    <label>üîë –ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" class="form-control" id="adminPassword" placeholder="prod2024">
                </div>
                <button class="btn btn-success" onclick="loginAsAdmin()" style="width: 100%;">
                    <i class="fas fa-lock"></i> –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                </button>
                <p style="margin-top: 15px; color: var(--gray); font-size: 12px;">
                    ‚ö†Ô∏è –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏
                </p>
            </div>
        </div>
    </div>

    <!-- –ö–û–ù–°–¢–†–£–ö–¢–û–† (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω) -->
    <div class="constructor-toolbar" id="constructorToolbar" style="display: none;">
        <div class="constructor-toggle" onclick="toggleConstructor()">
            <i class="fas fa-palette"></i>
        </div>
        <div id="editButtons" style="display: none;">
            <button class="edit-btn" onclick="editProducts()">üì¶ –¢–æ–≤–∞—Ä—ã</button>
            <button class="edit-btn" onclick="editCategories()">üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
            <button class="edit-btn" onclick="saveDesign()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="edit-btn" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- HEADER -->
    <header style="display: none;" id="mainHeader">
        <div class="header-top">
            <div class="container">
                <div class="header-contacts">
                    <i class="fas fa-phone"></i> +7 (923) 753-36-06
                    <span style="margin: 0 15px">|</span>
                    <i class="fas fa-envelope"></i> prodtorg.barnaul@gmail.com
                </div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <a href="#" class="logo">PROD-TORG BARNAUL<span>.</span></a>
                
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." onkeyup="searchProducts()">
                    <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="header-actions">
                    <a href="#" class="header-action" onclick="openCart(); return false;" style="position: relative;">
                        <i class="fas fa-shopping-cart"></i>
                        <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
                        <div class="cart-count" id="cartCount">0</div>
                    </a>
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar" id="userAvatar">–ì</div>
                        <div class="user-details">
                            <div class="user-name" id="userName">–ì–æ—Å—Ç—å</div>
                        </div>
                        <button class="logout-btn" onclick="logout()" title="–í—ã–π—Ç–∏">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="hero" style="display: none; padding: 150px 0 80px; text-align: center; color: white;" id="heroSection">
        <div class="container">
            <h1 style="font-size: 3rem; margin-bottom: 20px;">PROD-TORG BARNAUL</h1>
            <p style="font-size: 1.3rem; opacity: 0.9;">–û–ø—Ç–æ–≤–æ-—Ä–æ–∑–Ω–∏—á–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è –≤ –ë–∞—Ä–Ω–∞—É–ª–µ</p>
        </div>
    </section>

    <!-- –ö–ê–¢–ï–ì–û–†–ò–ò -->
    <section class="categories-section" style="display: none;" id="categoriesSection">
        <div class="container">
            <h2 class="section-title">–ö–ê–¢–ï–ì–û–†–ò–ò –¢–û–í–ê–†–û–í</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </section>

    <!-- –¢–û–í–ê–†–´ -->
    <section class="products-section" id="productsSection" style="display: none;">
        <div class="container">
            <div class="products-header">
                <h2 class="section-title" style="text-align: left; margin: 0;">–ù–ê–®–ò –¢–û–í–ê–†–´</h2>
                <div class="filters">
                    <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    </select>
                </div>
            </div>
            <div class="products-grid" id="productsGrid">
                <!-- –ó–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer style="display: none; background: rgba(0, 0, 0, 0.8); color: white; padding: 40px 0 20px; margin-top: 60px;" id="mainFooter">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i> +7 (923) 753-36-06</li>
                        <li><i class="fas fa-envelope"></i> prodtorg.barnaul@gmail.com</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 PROD-TORG BARNAUL</p>
            </div>
        </div>
    </footer>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ö–û–†–ó–ò–ù–´ -->
    <div id="cartModal" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content" style="background-color: white; margin: 5% auto; padding: 30px; border-radius: 15px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border);">
                <h3 style="margin: 0;">üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
                <span style="color: var(--gray); font-size: 28px; cursor: pointer;" onclick="closeCart()">&times;</span>
            </div>
            <div id="cartItems"></div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border); text-align: right; font-size: 1.2rem; font-weight: bold;">
                –ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚ÇΩ
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="checkout()" style="flex: 1;">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button class="btn btn-outline" onclick="closeCart()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>
    </div>

<script>
// ==================== –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò ====================
const SITE_CONFIG = {
    NAME: 'PROD-TORG BARNAUL',
    ADMIN_PASSWORDS: ['prod2024', 'admin123', '7533606', 'barnaul'],
    DEFAULT_CATEGORIES: [
        { name: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è', icon: 'üß¥', color1: '#667eea', color2: '#764ba2' },
        { name: '–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ', icon: 'üõèÔ∏è', color1: '#ff9a9e', color2: '#fad0c4' },
        { name: '–†—ã–±–∞ –∏ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã', icon: 'üêü', color1: '#4facfe', color2: '#00f2fe' },
        { name: '–ú—è—Å–æ –∏ –ø—Ç–∏—Ü–∞', icon: 'üçó', color1: '#f093fb', color2: '#f5576c' },
        { name: '–ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è', icon: 'üç∞', color1: '#f6d365', color2: '#fda085' },
        { name: '–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã', icon: 'ü•õ', color1: '#a1c4fd', color2: '#c2e9fb' },
        { name: '–ú–∞–Ω–≥–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã –∏ –º–∞–Ω–≥–∞–ª—ã', icon: 'üî•', color1: '#ffecd2', color2: '#fcb69f' }
    ]
};

// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
let products = [];
let cart = [];
let filteredProducts = [];
let categories = [];
let currentUser = null;
let isAdmin = false;

// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
function initApp() {
    loadFromLocalStorage();
    checkAutoLogin();
    
    if (currentUser) {
        showMainContent();
    } else {
        showLoginModal();
    }
}

function loadFromLocalStorage() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    products = JSON.parse(localStorage.getItem('prod_torg_products')) || getDefaultProducts();
    cart = JSON.parse(localStorage.getItem('prod_torg_cart')) || [];
    categories = JSON.parse(localStorage.getItem('prod_torg_categories')) || SITE_CONFIG.DEFAULT_CATEGORIES;
    currentUser = JSON.parse(localStorage.getItem('prod_torg_user'));
    isAdmin = localStorage.getItem('prod_torg_isAdmin') === 'true';
    
    filteredProducts = [...products];
}

function getDefaultProducts() {
    return [
        {
            id: 'BH-001',
            name: 'FAIRY banane - 5 –ª–∏—Ç—Ä–æ–≤',
            category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è',
            price: 800,
            quantity: 10,
            status: 'in_stock',
            description: '–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è –º—ã—Ç—å—è –ø–æ—Å—É–¥—ã. –ê—Ä–æ–º–∞—Ç: –ë–∞–Ω–∞–Ω.',
            image: 'https://i.postimg.cc/0hpWM833/FARY-BANANE-5-litrovi.jpg'
        }
    ];
}

// ==================== –°–ò–°–¢–ï–ú–ê –í–•–û–î–ê ====================
function showLoginModal() {
    document.getElementById('loginModal').style.display = 'flex';
}

function switchTab(tab) {
    document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
    
    if (tab === 'customer') {
        document.querySelector('.login-tab:first-child').classList.add('active');
        document.getElementById('customerForm').classList.add('active');
    } else {
        document.querySelector('.login-tab:last-child').classList.add('active');
        document.getElementById('adminForm').classList.add('active');
    }
}

function loginAsCustomer() {
    const name = document.getElementById('customerName').value;
    const phone = document.getElementById('customerPhone').value;
    
    if (!name || !phone) {
        showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
        return;
    }
    
    currentUser = {
        id: Date.now(),
        name: name,
        phone: phone,
        role: 'customer'
    };
    
    isAdmin = false;
    
    saveUserData();
    showNotification(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}!`);
    closeLogin();
    showMainContent();
}

function loginAsAdmin() {
    const login = document.getElementById('adminLogin').value;
    const password = document.getElementById('adminPassword').value;
    
    if (SITE_CONFIG.ADMIN_PASSWORDS.includes(password)) {
        currentUser = {
            id: 0,
            name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
            phone: '+7 (923) 753-36-06',
            role: 'admin'
        };
        
        isAdmin = true;
        
        saveUserData();
        showNotification('üëë –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
        closeLogin();
        showMainContent();
    } else {
        showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
    }
}

function checkAutoLogin() {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤—Ö–æ–¥–∞ –∞–¥–º–∏–Ω–∞
    const urlParams = new URLSearchParams(window.location.search);
    const adminKey = urlParams.get('admin');
    
    if (adminKey && SITE_CONFIG.ADMIN_PASSWORDS.includes(adminKey)) {
        loginAsAdmin();
    }
}

function saveUserData() {
    localStorage.setItem('prod_torg_user', JSON.stringify(currentUser));
    localStorage.setItem('prod_torg_isAdmin', isAdmin.toString());
}

function closeLogin() {
    document.getElementById('loginModal').style.display = 'none';
}

function logout() {
    currentUser = null;
    isAdmin = false;
    localStorage.removeItem('prod_torg_user');
    localStorage.removeItem('prod_torg_isAdmin');
    
    showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
    initApp();
}

// ==================== –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –ö–û–ù–¢–ï–ù–¢–ê ====================
function showMainContent() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('mainHeader').style.display = 'block';
    document.getElementById('heroSection').style.display = 'block';
    document.getElementById('categoriesSection').style.display = 'block';
    document.getElementById('productsSection').style.display = 'block';
    document.getElementById('mainFooter').style.display = 'block';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è –∞–¥–º–∏–Ω–∞
    if (isAdmin) {
        document.getElementById('constructorToolbar').style.display = 'block';
    }
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    updateUserInfo();
    loadCategories();
    loadProducts();
    updateCategoryFilter();
    updateCartCount();
}

function updateUserInfo() {
    if (currentUser) {
        document.getElementById('userName').textContent = currentUser.name;
        document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
    }
}

// ==================== –ö–ê–¢–ï–ì–û–†–ò–ò ====================
function loadCategories() {
    const categoriesGrid = document.getElementById('categoriesGrid');
    
    categoriesGrid.innerHTML = categories.map(category => {
        return `
            <div class="category-card" 
                 style="background: linear-gradient(135deg, ${category.color1}, ${category.color2})"
                 onclick="filterByCategory('${category.name}')">
                <span class="category-icon">${category.icon}</span>
                <h3>${category.name}</h3>
            </div>
        `;
    }).join('');
}

function updateCategoryFilter() {
    const categoryFilter = document.getElementById('categoryFilter');
    
    // –°–æ–±–∏—Ä–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const uniqueCategories = [...new Set(products.map(p => p.category))];
    
    categoryFilter.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>' +
        uniqueCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
}

function filterByCategory(category) {
    document.getElementById('categoryFilter').value = category;
    filterProducts();
    document.getElementById('productsSection').scrollIntoView({ behavior: 'smooth' });
}

// ==================== –¢–û–í–ê–†–´ ====================
function loadProducts() {
    const productsGrid = document.getElementById('productsGrid');
    
    if (filteredProducts.length === 0) {
        productsGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <h3 style="color: var(--gray); margin-bottom: 20px;">–¢–æ–≤–∞—Ä–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                ${isAdmin ? 
                    '<p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</p>' : 
                    '<p>–ó–∞—Ö–æ–¥–∏—Ç–µ –ø–æ–∑–∂–µ</p>'
                }
            </div>
        `;
        return;
    }
    
    productsGrid.innerHTML = filteredProducts.map(product => {
        const isAvailable = product.status === 'in_stock' && product.quantity > 0;
        
        return `
            <div class="product-card">
                <img src="${product.image}" alt="${product.name}" class="product-image"
                     onerror="this.onerror=null;this.src='https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
                <div class="product-info">
                    <div style="color: var(--gray); font-size: 12px; margin-bottom: 5px;">
                        ${product.category}
                    </div>
                    <h3 class="product-name">${product.name}</h3>
                    <div style="color: var(--gray); font-size: 0.9rem; margin-bottom: 10px; height: 40px; overflow: hidden;">
                        ${product.description}
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 15px;">
                        <span style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">
                            ${product.price.toLocaleString()} ‚ÇΩ
                        </span>
                    </div>
                    
                    <div style="margin-bottom: 15px; font-size: 0.8rem;">
                        ${isAvailable ? 
                            `<span style="color: var(--accent);">‚úì –í –Ω–∞–ª–∏—á–∏–∏: ${product.quantity} —à—Ç.</span>` : 
                            `<span style="color: var(--secondary);">‚úó –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>`
                        }
                    </div>
                    
                    <button class="btn btn-primary" onclick="addToCart('${product.id}')" 
                            style="width: 100%;" ${!isAvailable ? 'disabled' : ''}>
                        <i class="fas fa-shopping-cart"></i> ${isAvailable ? '–í –∫–æ—Ä–∑–∏–Ω—É' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

function filterProducts() {
    const category = document.getElementById('categoryFilter').value;
    
    filteredProducts = products.filter(product => {
        if (category && product.category !== category) return false;
        return true;
    });
    
    loadProducts();
}

function searchProducts() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    
    if (searchTerm.trim() === '') {
        filteredProducts = [...products];
    } else {
        filteredProducts = products.filter(product => 
            product.name.toLowerCase().includes(searchTerm) ||
            product.description.toLowerCase().includes(searchTerm) ||
            product.category.toLowerCase().includes(searchTerm)
        );
    }
    
    loadProducts();
}

// ==================== –ö–û–†–ó–ò–ù–ê ====================
function addToCart(productId) {
    if (!currentUser) {
        showNotification('‚ùå –°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
        return;
    }
    
    const product = products.find(p => p.id === productId);
    if (!product) return;

    const existingItem = cart.find(item => item.id === productId);
    
    if (existingItem) {
        existingItem.quantity += 1;
    } else {
        cart.push({
            ...product,
            quantity: 1,
            cartId: Date.now()
        });
    }
    
    saveCart();
    updateCartCount();
    showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
}

function saveCart() {
    localStorage.setItem('prod_torg_cart', JSON.stringify(cart));
}

function updateCartCount() {
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = totalItems;
}

function openCart() {
    const modal = document.getElementById('cartModal');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    
    if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align: center; color: var(--gray); padding: 40px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
        cartTotal.textContent = '0';
    } else {
        cartItems.innerHTML = cart.map(item => `
            <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border-bottom: 1px solid var(--border);">
                <img src="${item.image}" alt="${item.name}" 
                     style="width: 60px; height: 60px; object-fit: cover; border-radius: 8px;"
                     onerror="this.src='https://via.placeholder.com/60x60/ecf0f1/7f8c8d?text=–ù–µ—Ç'">
                <div style="flex: 1;">
                    <div style="font-weight: bold; margin-bottom: 5px;">${item.name}</div>
                    <div style="color: var(--primary); font-weight: bold;">
                        ${item.price.toLocaleString()} ‚ÇΩ √ó ${item.quantity}
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button onclick="changeQuantity(${item.cartId}, -1)" 
                            style="width: 30px; height: 30px; border: 1px solid var(--border); background: white; border-radius: 50%; cursor: pointer;">-</button>
                    <span>${item.quantity}</span>
                    <button onclick="changeQuantity(${item.cartId}, 1)" 
                            style="width: 30px; height: 30px; border: 1px solid var(--border); background: white; border-radius: 50%; cursor: pointer;">+</button>
                </div>
                <button onclick="removeFromCart(${item.cartId})" 
                        style="background: var(--secondary); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `).join('');
        
        const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        cartTotal.textContent = total.toLocaleString();
    }
    
    modal.style.display = 'block';
}

function closeCart() {
    document.getElementById('cartModal').style.display = 'none';
}

function changeQuantity(cartId, change) {
    const item = cart.find(item => item.cartId === cartId);
    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            removeFromCart(cartId);
        } else {
            saveCart();
            updateCartCount();
            openCart();
        }
    }
}

function removeFromCart(cartId) {
    cart = cart.filter(item => item.cartId !== cartId);
    saveCart();
    updateCartCount();
    openCart();
    showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
}

function checkout() {
    if (cart.length === 0) {
        showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
        return;
    }
    
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    
    // –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
    const order = {
        id: Date.now(),
        customer: currentUser,
        items: [...cart],
        total: total,
        date: new Date().toISOString(),
        status: 'new'
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑
    const orders = JSON.parse(localStorage.getItem('prod_torg_orders')) || [];
    orders.push(order);
    localStorage.setItem('prod_torg_orders', JSON.stringify(orders));
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    sendOrderNotification(order);
    
    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart = [];
    saveCart();
    updateCartCount();
    closeCart();
    
    showNotification(`‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°—É–º–º–∞: ${total.toLocaleString()} ‚ÇΩ`);
}

function sendOrderNotification(order) {
    const message = `
üì¶ –ù–û–í–´–ô –ó–ê–ö–ê–ó #${order.id}
üë§ –ö–ª–∏–µ–Ω—Ç: ${order.customer.name}
üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${order.customer.phone}
üí∞ –°—É–º–º–∞: ${order.total.toLocaleString()} ‚ÇΩ

–¢–æ–≤–∞—Ä—ã:
${order.items.map(item => `‚Ä¢ ${item.name} √ó ${item.quantity} = ${(item.price * item.quantity).toLocaleString()} ‚ÇΩ`).join('\n')}
    `;
    
    console.log('Order notification:', message);
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram –∏–ª–∏ email
}

// ==================== –ö–û–ù–°–¢–†–£–ö–¢–û–† (–ê–î–ú–ò–ù) ====================
function toggleConstructor() {
    const toolbar = document.querySelector('.constructor-toolbar');
    const editButtons = document.getElementById('editButtons');
    
    if (toolbar.classList.contains('expanded')) {
        toolbar.classList.remove('expanded');
        editButtons.style.display = 'none';
    } else {
        toolbar.classList.add('expanded');
        editButtons.style.display = 'flex';
    }
}

function editProducts() {
    if (!isAdmin) {
        showNotification('‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞–º–∏
    const modalHTML = `
        <div id="productsModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; display: flex; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h3>
                    <span onclick="closeProductsModal()" style="font-size: 28px; color: var(--gray); cursor: pointer;">&times;</span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <h4>üì§ –ò–º–ø–æ—Ä—Ç –∏–∑ CSV</h4>
                    <input type="file" id="csvFile" accept=".csv" 
                           style="margin: 10px 0; padding: 10px; border: 2px dashed #ccc; width: 100%;"
                           onchange="importCSV(this.files[0])">
                    <small style="color: var(--gray);">–§–æ—Ä–º–∞—Ç: id,category,name,description,price,quantity,status,image_url</small>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button onclick="showAddProductForm()" 
                            style="width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤—Ä—É—á–Ω—É—é
                    </button>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    <h4>–¢–æ–≤–∞—Ä–æ–≤: ${products.length}</h4>
                    ${products.map((product, index) => `
                        <div style="border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: start;">
                                <div>
                                    <strong>${product.name}</strong>
                                    <div style="color: var(--gray); font-size: 0.9rem;">${product.category}</div>
                                    <div style="color: var(--primary); font-weight: bold;">${product.price} ‚ÇΩ</div>
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <button onclick="editProductInModal(${index})" style="padding: 5px 10px; border: 1px solid var(--primary); color: var(--primary); background: white; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button onclick="deleteProductInModal(${index})" style="padding: 5px 10px; border: 1px solid var(--secondary); color: var(--secondary); background: white; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeProductsModal() {
    const modal = document.getElementById('productsModal');
    if (modal) modal.remove();
}

// ==================== –ò–ú–ü–û–†–¢ CSV (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô) ====================
function importCSV(file) {
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const csvData = e.target.result;
            const lines = csvData.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase());
            
            const newProducts = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ CSV
                let values = [];
                let current = '';
                let inQuotes = false;
                
                for (let char of lines[i]) {
                    if (char === '"') {
                        inQuotes = !inQuotes;
                    } else if (char === ',' && !inQuotes) {
                        values.push(current);
                        current = '';
                    } else {
                        current += char;
                    }
                }
                values.push(current);
                
                // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Ç–æ–≤–∞—Ä–∞
                const product = {};
                headers.forEach((header, index) => {
                    product[header] = (values[index] || '').trim();
                });
                
                // –§–ò–ö–°: –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                let imageUrl = product.image_url || product.image || '';
                
                // –ï—Å–ª–∏ URL –∏–∑ PostImage, —É–±–µ–¥–∏–º—Å—è —á—Ç–æ –æ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
                if (imageUrl.includes('postimg.cc')) {
                    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –∫–∞–≤—ã—á–∫–∏ –µ—Å–ª–∏ –µ—Å—Ç—å
                    imageUrl = imageUrl.replace(/"/g, '');
                    // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ —ç—Ç–æ –ø–æ–ª–Ω—ã–π URL
                    if (!imageUrl.startsWith('http')) {
                        imageUrl = 'https://' + imageUrl;
                    }
                }
                
                if (!product.name || !product.category) {
                    console.warn('–ü—Ä–æ–ø—É—â–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞ –±–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:', product);
                    continue;
                }
                
                const newProduct = {
                    id: product.id || `prod-${Date.now()}-${i}`,
                    name: product.name,
                    category: product.category,
                    price: parseInt(product.price) || 0,
                    quantity: parseInt(product.quantity) || 0,
                    status: (product.status || 'in_stock').toLowerCase(),
                    description: product.description || '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
                    image: imageUrl || 'https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'
                };
                
                newProducts.push(newProduct);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
            products = [...products, ...newProducts];
            saveProducts();
            filteredProducts = [...products];
            loadProducts();
            updateCategoryFilter();
            
            closeProductsModal();
            showNotification(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${newProducts.length} —Ç–æ–≤–∞—Ä–æ–≤`);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV —Ñ–∞–π–ª–∞');
        }
    };
    
    reader.readAsText(file, 'UTF-8');
}

function showAddProductForm() {
    const formHTML = `
        <div id="addProductModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10002; display: flex; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px;">
                <h3>‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                
                <div style="margin-bottom: 15px;">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="newProductName" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="newProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        ${categories.map(cat => `<option value="${cat.name}">${cat.name}</option>`).join('')}
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–¶–µ–Ω–∞:</label>
                    <input type="number" id="newProductPrice" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="newProductQuantity" value="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <input type="text" id="newProductImage" placeholder="https://example.com/image.jpg" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="saveNewProduct()" style="flex: 1; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button onclick="closeAddProductModal()" style="padding: 12px; background: #ccc; color: #333; border: none; border-radius: 8px; cursor: pointer;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', formHTML);
}

function closeAddProductModal() {
    const modal = document.getElementById('addProductModal');
    if (modal) modal.remove();
}

function saveNewProduct() {
    const name = document.getElementById('newProductName').value;
    const category = document.getElementById('newProductCategory').value;
    const price = parseInt(document.getElementById('newProductPrice').value);
    const quantity = parseInt(document.getElementById('newProductQuantity').value);
    const image = document.getElementById('newProductImage').value;
    
    if (!name || !category || !price) {
        showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    const newProduct = {
        id: `prod-${Date.now()}`,
        name: name,
        category: category,
        price: price,
        quantity: quantity || 0,
        status: 'in_stock',
        description: '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä',
        image: image || 'https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'
    };
    
    products.push(newProduct);
    saveProducts();
    filteredProducts = [...products];
    loadProducts();
    updateCategoryFilter();
    
    closeAddProductModal();
    closeProductsModal();
    showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
}

function editProductInModal(index) {
    const product = products[index];
    
    const formHTML = `
        <div id="editProductModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10002; display: flex; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 500px;">
                <h3>‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</h3>
                
                <div style="margin-bottom: 15px;">
                    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                    <input type="text" id="editProductName" value="${product.name}" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                    <select id="editProductCategory" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        ${categories.map(cat => 
                            `<option value="${cat.name}" ${cat.name === product.category ? 'selected' : ''}>${cat.name}</option>`
                        ).join('')}
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–¶–µ–Ω–∞:</label>
                    <input type="number" id="editProductPrice" value="${product.price}" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                    <input type="number" id="editProductQuantity" value="${product.quantity}" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label>URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label>
                    <input type="text" id="editProductImage" value="${product.image}" 
                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button onclick="saveEditedProduct(${index})" 
                            style="flex: 1; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button onclick="closeEditProductModal()" 
                            style="padding: 12px; background: #ccc; color: #333; border: none; border-radius: 8px; cursor: pointer;">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', formHTML);
}

function closeEditProductModal() {
    const modal = document.getElementById('editProductModal');
    if (modal) modal.remove();
}

function saveEditedProduct(index) {
    const name = document.getElementById('editProductName').value;
    const category = document.getElementById('editProductCategory').value;
    const price = parseInt(document.getElementById('editProductPrice').value);
    const quantity = parseInt(document.getElementById('editProductQuantity').value);
    const image = document.getElementById('editProductImage').value;
    
    if (!name || !category || !price) {
        showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
        return;
    }
    
    products[index] = {
        ...products[index],
        name: name,
        category: category,
        price: price,
        quantity: quantity,
        image: image
    };
    
    saveProducts();
    filteredProducts = [...products];
    loadProducts();
    
    closeEditProductModal();
    closeProductsModal();
    showNotification('‚úÖ –¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
}

function deleteProductInModal(index) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
        products.splice(index, 1);
        saveProducts();
        filteredProducts = [...products];
        loadProducts();
        updateCategoryFilter();
        
        closeProductsModal();
        showNotification('‚úÖ –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');
    }
}

function saveProducts() {
    localStorage.setItem('prod_torg_products', JSON.stringify(products));
}

function editCategories() {
    if (!isAdmin) {
        showNotification('‚ùå –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞');
        return;
    }
    
    const modalHTML = `
        <div id="categoriesModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 10001; display: flex; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 800px; max-height: 80vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">üìÇ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</h3>
                    <span onclick="closeCategoriesModal()" style="font-size: 28px; color: var(--gray); cursor: pointer;">&times;</span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button onclick="showAddCategoryForm()" 
                            style="width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    </button>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${categories.map((category, index) => `
                        <div style="border: 1px solid var(--border); border-radius: 10px; padding: 15px; margin-bottom: 10px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <span style="font-size: 2rem;">${category.icon}</span>
                                    <div>
                                        <strong>${category.name}</strong>
                                        <div style="color: var(--gray); font-size: 0.9rem;">
                                            ${category.color1} ‚Üí ${category.color2}
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 5px;">
                                    <button onclick="editCategoryInModal(${index})" style="padding: 5px 10px; border: 1px solid var(--primary); color: var(--primary); background: white; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    ${index > 6 ? `
                                    <button onclick="deleteCategoryInModal(${index})" style="padding: 5px 10px; border: 1px solid var(--secondary); color: var(--secondary); background: white; border-radius: 5px; cursor: pointer;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        </div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
}

function closeCategoriesModal() {
    const modal = document.getElementById('categoriesModal');
    if (modal) modal.remove();
}

function saveCategories() {
    localStorage.setItem('prod_torg_categories', JSON.stringify(categories));
    loadCategories();
}

// ==================== –£–¢–ò–õ–ò–¢–´ ====================
function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

function saveDesign() {
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
    saveProducts();
    saveCart();
    saveCategories();
    
    showNotification('üíæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
}

// ==================== –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================
document.addEventListener('DOMContentLoaded', function() {
    initApp();
});

// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
window.filterByCategory = filterByCategory;
window.filterProducts = filterProducts;
window.searchProducts = searchProducts;
window.addToCart = addToCart;
window.openCart = openCart;
window.closeCart = closeCart;
window.logout = logout;
window.toggleConstructor = toggleConstructor;
window.editProducts = editProducts;
window.editCategories = editCategories;
window.saveDesign = saveDesign;
window.switchTab = switchTab;
window.loginAsCustomer = loginAsCustomer;
window.loginAsAdmin = loginAsAdmin;
window.changeQuantity = changeQuantity;
window.removeFromCart = removeFromCart;
window.checkout = checkout;
window.importCSV = importCSV;
</script>
</body>
</html>
