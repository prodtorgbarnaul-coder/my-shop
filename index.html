<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∞–≥–∞–∑–∏–Ω –¥–ª—è —Å–≤–æ–∏—Ö</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        /* ==================== –í–°–ï –°–¢–ò–õ–ò –ò–ó –ü–û–°–õ–ï–î–ù–ï–ì–û –ö–û–î–ê ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2c5aa0;
            --secondary: #e74c3c;
            --accent: #27ae60;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #6c757d;
            --border: #e9ecef;
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: var(--bg-gradient);
            min-height: 100vh;
            scroll-behavior: smooth;
        }

        /* –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .auth-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s ease;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border);
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-title {
            text-align: center;
            margin-bottom: 30px;
            color: var(--dark);
            font-size: 1.8rem;
        }

        .admin-note {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--accent);
        }

        /* –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–• */
        .data-sync-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10001;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: none;
            max-width: 300px;
        }

        .sync-btn {
            background: linear-gradient(135deg, var(--accent), #219a52);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 10px;
            width: 100%;
        }

        .sync-qr {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
            margin-top: 10px;
        }

        /* –ö–û–ù–°–¢–†–£–ö–¢–û–† */
        .constructor-toolbar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 10000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .constructor-toggle {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }

        .constructor-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(44, 90, 160, 0.4);
        }

        .constructor-toolbar.expanded {
            border-radius: 25px;
            padding: 15px;
        }

        .constructor-toolbar.expanded .constructor-toggle {
            margin-bottom: 15px;
        }

        #editButtons {
            display: flex;
            flex-direction: column;
            gap: 8px;
            animation: fadeIn 0.3s ease;
        }

        .edit-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border);
            color: var(--dark);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .edit-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateX(-5px);
        }

        /* –ü–ê–ù–ï–õ–ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø */
        .edit-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
            display: none;
        }

        .edit-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 9999;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow: hidden;
            display: none;
        }

        .edit-panel-content {
            max-height: calc(80vh - 120px);
            overflow-y: auto;
            padding-right: 10px;
        }

        .edit-panel-content::-webkit-scrollbar {
            width: 6px;
        }

        .edit-panel-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .edit-panel-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        /* –û–°–ù–û–í–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ –§–û–†–ú */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
        }

        .color-picker {
            width: 60px;
            height: 40px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--accent);
            color: white;
        }

        .btn-danger {
            background: var(--secondary);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }

        .file-upload {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .file-upload:hover {
            border-color: var(--primary);
        }

        /* –•–ï–î–ï–† */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }

        .header-top {
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            color: white;
            padding: 8px 0;
            font-size: 14px;
        }

        .header-main {
            padding: 15px 0;
        }

        .header-main .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .search-bar {
            flex: 0 1 400px;
            position: relative;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid var(--border);
            border-radius: 30px;
            font-size: 14px;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .search-bar button {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--dark);
            font-size: 12px;
            transition: transform 0.3s ease;
        }

        .header-action:hover {
            transform: translateY(-2px);
        }

        .header-action i {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .cart-count {
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -5px;
            right: -5px;
            font-weight: bold;
        }

        .notification-count {
            background: var(--accent);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -3px;
            right: -3px;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--dark);
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            border: 1px solid var(--border);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 12px;
            font-weight: bold;
        }

        .user-role {
            font-size: 10px;
            color: var(--gray);
        }

        .logout-btn {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* HERO SECTION */
        .hero {
            background: transparent;
            color: white;
            padding: 150px 0 80px;
            margin-top: 0;
            text-align: center;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: -1;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 30px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .categories-section {
            padding: 80px 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 0 20px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .section-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 50px;
            color: var(--dark);
            position: relative;
            font-weight: 700;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 80px;
            height: 4px;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            margin: 15px auto;
            border-radius: 2px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .category-card {
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            text-decoration: none;
            color: white;
            transition: all 0.4s ease;
            border: none;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            background-size: cover !important;
            background-position: center !important;
            background-repeat: no-repeat !important;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.1) 100%);
            transition: opacity 0.3s ease;
            z-index: 1;
        }

        .category-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .category-card:hover::before {
            background: linear-gradient(135deg, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0.2) 100%);
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
            position: relative;
            z-index: 2;
        }

        .category-card h3 {
            font-size: 1.2rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }

        /* –¢–û–í–ê–†–´ */
        .products-section {
            padding: 80px 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            margin: 40px 20px 0;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .products-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 10px 20px;
            border: 2px solid var(--border);
            border-radius: 25px;
            background: white;
            font-size: 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .product-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: linear-gradient(135deg, var(--secondary), #c0392b);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
            z-index: 2;
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            object-position: center;
            transition: transform 0.3s ease;
            cursor: pointer;
            background-color: #f8f9fa;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-info {
            padding: 20px;
        }

        .product-category {
            color: var(--gray);
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark);
            line-height: 1.3;
            cursor: pointer;
        }

        .product-name:hover {
            color: var(--primary);
        }

        .product-description-short {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .current-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .old-price {
            font-size: 1.1rem;
            color: var(--gray);
            text-decoration: line-through;
        }

        .discount {
            background: linear-gradient(135deg, var(--accent), #219a52);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .product-status {
            font-size: 0.8rem;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .status-in-stock {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            color: #155724;
        }

        .status-pre-order {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
        }

        .status-out-of-stock {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            color: #721c24;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .add-to-cart {
            flex: 1;
            background: linear-gradient(135deg, var(--primary), #1a3a6b);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-to-cart:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 90, 160, 0.4);
        }

        .add-to-cart:disabled {
            background: linear-gradient(135deg, #bdc3c7, #95a5a6);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .details-btn {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .details-btn:hover {
            background: var(--primary);
            color: white;
        }

        /* –§–£–¢–ï–† */
        footer {
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 40px 0 20px;
            margin-top: 60px;
            backdrop-filter: blur(10px);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.7);
        }

        /* –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--dark);
        }

        .close {
            color: var(--gray);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: var(--secondary);
        }

        /* –ö–û–†–ó–ò–ù–ê */
        .cart-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .cart-item-image {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: bold;
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background: var(--primary);
            color: white;
        }

        .cart-total {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--border);
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* –ó–ê–ö–ê–ó–´ */
        .order-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .order-item {
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            background: #f8f9fa;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .order-status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-new {
            background: #cfe2ff;
            color: #084298;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d1e7dd;
            color: #0f5132;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .order-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed var(--border);
        }

        /* –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–Ø */
        .image-preview-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border-radius: 8px;
            border: 2px solid var(--border);
            display: none;
        }

        .image-preview.visible {
            display: block;
        }

        .uploaded-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            display: none;
        }

        /* –ò–ù–¢–ï–ì–†–ê–¶–ò–ò */
        .telegram-integration {
            background: linear-gradient(135deg, #0088cc, #34b7f1);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .max-integration {
            background: linear-gradient(135deg, #00b894, #00cec9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .integration-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* –ê–î–ê–ü–¢–ò–í */
        @media (max-width: 768px) {
            .header-main .container {
                flex-direction: column;
                gap: 15px;
            }

            .search-bar {
                flex: 1;
                width: 100%;
            }

            .hero h1 {
                font-size: 2.2rem;
            }

            .products-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }

            .categories-section,
            .products-section {
                margin: 0 10px;
                padding: 40px 20px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
    <div class="auth-overlay" id="authOverlay">
        <div class="auth-container">
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="switchAuthTab('customer')">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
                <div class="auth-tab" onclick="switchAuthTab('admin')">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è -->
            <div class="auth-form active" id="customerAuth">
                <h3 class="auth-title">–í—Ö–æ–¥ –¥–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π</h3>
                <div class="form-group">
                    <label>–í–∞—à–µ –∏–º—è:</label>
                    <input type="text" class="form-control" id="customerName" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
                </div>
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" class="form-control" id="customerPhone" placeholder="+7 (XXX) XXX-XX-XX">
                </div>
                <div class="form-group">
                    <label>Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <input type="email" class="form-control" id="customerEmail" placeholder="email@example.com">
                </div>
                <button class="btn btn-primary" onclick="loginAsCustomer()" style="width: 100%;">
                    –í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å
                </button>
                <p style="text-align: center; margin-top: 15px; color: var(--gray);">
                    –ò–ª–∏ <a href="#" onclick="continueAsGuest()" style="color: var(--primary);">–ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å</a>
                </p>
            </div>
            
            <!-- –§–æ—Ä–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
            <div class="auth-form" id="adminAuth">
                <h3 class="auth-title">–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
                <div class="form-group">
                    <label>–õ–æ–≥–∏–Ω:</label>
                    <input type="text" class="form-control" id="adminLogin" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="form-group">
                    <label>–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" class="form-control" id="adminPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="btn btn-primary" onclick="loginAsAdmin()" style="width: 100%;">
                    –í–æ–π—Ç–∏ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                </button>
                <div class="admin-note">
                    <p><strong>–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong></p>
                    <p>–õ–æ–≥–∏–Ω: admin</p>
                    <p>–ü–∞—Ä–æ–ª—å: 123456</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
    <div class="data-sync-panel" id="syncPanel">
        <button class="sync-btn" onclick="exportData()">
            <i class="fas fa-share-alt"></i> –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        </button>
        <button class="sync-btn" onclick="importData()">
            <i class="fas fa-download"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        </button>
        <button class="sync-btn" onclick="backupData()">
            <i class="fas fa-save"></i> –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
        </button>
        <button class="sync-btn" onclick="restoreData()">
            <i class="fas fa-undo"></i> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
        </button>
    </div>

    <!-- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä -->
    <div class="constructor-toolbar" id="constructorToolbar" style="display: none;">
        <div class="constructor-toggle" onclick="toggleConstructor()">
            <i class="fas fa-palette"></i>
        </div>
        <div id="editButtons" style="display: none;">
            <button class="edit-btn" onclick="editBackground()">–§–æ–Ω —Å–∞–π—Ç–∞</button>
            <button class="edit-btn" onclick="editHeader()">–®–∞–ø–∫–∞</button>
            <button class="edit-btn" onclick="editCategories()">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</button>
            <button class="edit-btn" onclick="editProducts()">–¢–æ–≤–∞—Ä—ã</button>
            <button class="edit-btn" onclick="editOrders()">–ó–∞–∫–∞–∑—ã</button>
            <button class="edit-btn" onclick="editGiveaway()">–†–æ–∑—ã–≥—Ä—ã—à</button>
            <button class="edit-btn" onclick="saveDesign()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="edit-btn" onclick="syncData()">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
            <button class="edit-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <div class="edit-overlay" id="editOverlay"></div>

    <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="edit-panel" id="productsPanel">
        <div class="edit-panel-content" id="productsPanelContent">
            <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        <div class="panel-actions">
            <button class="btn btn-danger" onclick="closePanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <!-- ==================== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ==================== -->
    
    <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
    <div id="cartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
                <span class="close" onclick="closeCart()">&times;</span>
            </div>
            <div id="cartItems">
                <!-- –¢–æ–≤–∞—Ä—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <div class="cart-total">
                –ò—Ç–æ–≥–æ: <span id="cartTotal">0</span> ‚ÇΩ
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button class="btn btn-primary" onclick="checkout()" style="flex: 1;">
                    <i class="fas fa-check"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
                <button class="btn btn-outline" onclick="closeCart()">
                    <i class="fas fa-shopping-cart"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
    <div id="checkoutModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
                <span class="close" onclick="closeCheckout()">&times;</span>
            </div>
            <div id="checkoutContent">
                <!-- –§–æ—Ä–º–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üë§ –ü—Ä–æ—Ñ–∏–ª—å</h3>
                <span class="close" onclick="closeProfile()">&times;</span>
            </div>
            <div id="profileContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞ -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="productModalTitle">–¢–æ–≤–∞—Ä</h3>
                <span class="close" onclick="closeProductModal()">&times;</span>
            </div>
            <div id="productModalContent">
                <!-- –î–µ—Ç–∞–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ó–∞–∫–∞–∑—ã -->
    <div id="ordersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üì¶ –ú–æ–∏ –∑–∞–∫–∞–∑—ã</h3>
                <span class="close" onclick="closeOrders()">&times;</span>
            </div>
            <div id="ordersContent">
                <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram -->
    <div id="telegramModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üì± Telegram –±–æ—Ç</h3>
                <span class="close" onclick="closeTelegramModal()">&times;</span>
            </div>
            <div id="telegramContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="mainHeader" style="display: none;">
        <div class="header-top">
            <div class="container">
                <div class="header-contacts">
                    <i class="fas fa-phone"></i> +7 (923) 753-36-06
                    <span style="margin: 0 15px">|</span>
                    <i class="fas fa-envelope"></i> prodtorg.barnaul@gmail.com
                </div>
            </div>
        </div>
        <div class="header-main">
            <div class="container">
                <a href="#" class="logo" id="siteLogo">–î–õ–Ø –°–í–û–ò–•<span>.</span></a>
                
                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤...">
                    <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="header-actions">
                    <a href="#" class="header-action" onclick="openProfile(); return false;">
                        <i class="far fa-user"></i>
                        <span id="userNameDisplay">–ü—Ä–æ—Ñ–∏–ª—å</span>
                    </a>
                    <a href="#" class="header-action" onclick="openCart(); return false;" style="position: relative;">
                        <i class="fas fa-shopping-cart"></i>
                        <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
                        <div class="cart-count" id="cartCount">0</div>
                    </a>
                    <div class="user-info" id="userInfo">
                        <div class="user-avatar" id="userAvatar">–ì</div>
                        <div class="user-details">
                            <div class="user-name" id="userFullName">–ì–æ—Å—Ç—å</div>
                            <div class="user-role" id="userRoleDisplay">–ì–æ—Å—Ç—å</div>
                        </div>
                        <button class="logout-btn" onclick="logout()" title="–í—ã–π—Ç–∏">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="heroSection" style="display: none;">
        <div class="container">
            <h1 id="siteTitle">–ú–∞–≥–∞–∑–∏–Ω –¥–ª—è —Å–≤–æ–∏—Ö</h1>
            <p id="siteSubtitle">–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—à–µ–≥–æ –∫—Ä—É–≥–∞</p>
        </div>
    </section>

    <!-- Categories Section -->
    <section class="categories-section" id="categoriesSection" style="display: none;">
        <div class="container">
            <h2 class="section-title">–ö–ê–¢–ï–ì–û–†–ò–ò –¢–û–í–ê–†–û–í</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- Categories will be loaded by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products-section" id="productsSection" style="display: none;">
        <div class="container">
            <div class="products-header">
                <h2 class="section-title" style="text-align: left; margin: 0;">–ü–û–ü–£–õ–Ø–†–ù–´–ï –¢–û–í–ê–†–´</h2>
                <div class="filters">
                    <select class="filter-select" id="categoryFilter" onchange="filterProducts()">
                        <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    </select>
                    <select class="filter-select" id="priceFilter" onchange="filterProducts()">
                        <option value="">–õ—é–±–∞—è —Ü–µ–Ω–∞</option>
                        <option value="0-500">–î–æ 500 —Ä—É–±.</option>
                        <option value="500-1000">500-1000 —Ä—É–±.</option>
                        <option value="1000-5000">1000-5000 —Ä—É–±.</option>
                        <option value="5000-999999">–û—Ç 5000 —Ä—É–±.</option>
                    </select>
                    <select class="filter-select" id="sortBy" onchange="sortProducts()">
                        <option value="name">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
                        <option value="price_asc">–¶–µ–Ω–∞ (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é)</option>
                        <option value="price_desc">–¶–µ–Ω–∞ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)</option>
                        <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
                    </select>
                </div>
            </div>
            <div class="products-grid" id="productsGrid">
                <!-- Products will be loaded by JavaScript -->
            </div>
        </div>
    </section>

    <!-- –§—É—Ç–µ—Ä -->
    <footer id="mainFooter" style="display: none;">
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>–û –º–∞–≥–∞–∑–∏–Ω–µ</h3>
                    <p style="color: #bdc3c7; line-height: 1.6;">
                        –ó–∞–∫—Ä—ã—Ç—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–ª—è –¥—Ä—É–∑–µ–π –∏ –±–ª–∏–∑–∫–∏—Ö. 
                        –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã, —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Ä–æ–∑—ã–≥—Ä—ã—à–∏ –ø—Ä–∏–∑–æ–≤.
                    </p>
                </div>
                <div class="footer-column">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i> +7 (923) 753-36-06</li>
                        <li><i class="fas fa-envelope"></i> prodtorg.barnaul@gmail.com</li>
                        <li><i class="fas fa-map-marker-alt"></i> –≥. –ë–∞—Ä–Ω–∞—É–ª</li>
                        <li><i class="fas fa-clock"></i> –ü–Ω-–í—Å: 9:00-21:00</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                    <ul>
                        <li><i class="fas fa-box"></i> <a href="#" onclick="openOrders(); return false;" style="color: white;">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a></li>
                        <li><i class="fas fa-question-circle"></i> <a href="#" onclick="showHelp(); return false;" style="color: white;">–ü–æ–º–æ—â—å</a></li>
                        <li><i class="fas fa-gift"></i> <a href="#" onclick="editGiveaway(); return false;" style="color: white;">–†–æ–∑—ã–≥—Ä—ã—à–∏</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 –ú–∞–≥–∞–∑–∏–Ω "–î–ª—è —Å–≤–æ–∏—Ö". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script>
        // ==================== –°–ò–°–¢–ï–ú–ê –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–ò –î–ê–ù–ù–´–• ====================
        
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentUser = null;
        let isAdmin = false;
        let products = [];
        let cart = [];
        let filteredProducts = [];
        let customers = [];
        let orders = [];
        let categoriesData = [];
        let siteSettings = {};
        let telegramSettings = {};
        let maxSettings = {};
        
        // IndexedDB –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
        let db;
        const DB_NAME = 'ProdTorgDB';
        const DB_VERSION = 2;
        
        // ==================== INDEXEDDB –§–£–ù–ö–¶–ò–ò ====================
        
        async function initDatabase() {
            return new Promise((resolve) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => {
                    console.warn('IndexedDB –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage');
                    loadFromLocalStorage();
                    resolve(false);
                };
                
                request.onsuccess = (event) => {
                    db = event.target.result;
                    console.log('IndexedDB –ø–æ–¥–∫–ª—é—á–µ–Ω');
                    
                    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB
                    loadFromIndexedDB().then(() => {
                        resolve(true);
                    });
                };
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    const oldVersion = event.oldVersion;
                    
                    if (oldVersion < 1) {
                        // –°–æ–∑–¥–∞–µ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                        const productStore = db.createObjectStore('products', { keyPath: 'id' });
                        productStore.createIndex('category', 'category', { unique: false });
                        
                        db.createObjectStore('categories', { keyPath: 'name' });
                        db.createObjectStore('settings', { keyPath: 'id' });
                        db.createObjectStore('orders', { keyPath: 'id' });
                        db.createObjectStore('customers', { keyPath: 'id' });
                        db.createObjectStore('cart', { keyPath: 'cartId' });
                        db.createObjectStore('telegram', { keyPath: 'id' });
                        db.createObjectStore('max', { keyPath: 'id' });
                    }
                };
            });
        }
        
        async function loadFromIndexedDB() {
            if (!db) {
                loadFromLocalStorage();
                return;
            }
            
            try {
                const transaction = db.transaction([
                    'products', 'categories', 'settings', 'orders', 
                    'customers', 'cart', 'telegram', 'max'
                ], 'readonly');
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
                const promises = [
                    getAllFromStore(transaction, 'products'),
                    getAllFromStore(transaction, 'categories'),
                    getAllFromStore(transaction, 'settings'),
                    getAllFromStore(transaction, 'orders'),
                    getAllFromStore(transaction, 'customers'),
                    getAllFromStore(transaction, 'cart'),
                    getAllFromStore(transaction, 'telegram'),
                    getAllFromStore(transaction, 'max')
                ];
                
                const results = await Promise.all(promises);
                
                // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                products = results[0] || [];
                categoriesData = results[1] || getDefaultCategories();
                const settingsArray = results[2] || [];
                orders = results[3] || [];
                customers = results[4] || [];
                cart = results[5] || [];
                const telegramArray = results[6] || [];
                const maxArray = results[7] || [];
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                siteSettings = settingsArray[0] || getDefaultSettings();
                telegramSettings = telegramArray[0] || {};
                maxSettings = maxArray[0] || {};
                
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ localStorage (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
                currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
                isAdmin = localStorage.getItem('isAdmin') === 'true';
                
                console.log('–î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ IndexedDB');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ IndexedDB:', error);
                loadFromLocalStorage();
            }
        }
        
        function getAllFromStore(transaction, storeName) {
            return new Promise((resolve) => {
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = () => {
                    resolve(request.result);
                };
                
                request.onerror = () => {
                    resolve([]);
                };
            });
        }
        
        async function saveToIndexedDB() {
            if (!db) {
                saveToLocalStorage();
                return;
            }
            
            try {
                const transaction = db.transaction([
                    'products', 'categories', 'settings', 'orders', 
                    'customers', 'cart', 'telegram', 'max'
                ], 'readwrite');
                
                // –û—á–∏—â–∞–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
                await clearAndSaveStore(transaction, 'products', products);
                await clearAndSaveStore(transaction, 'categories', categoriesData);
                await clearAndSaveStore(transaction, 'settings', [{ id: 'main', ...siteSettings }]);
                await clearAndSaveStore(transaction, 'orders', orders);
                await clearAndSaveStore(transaction, 'customers', customers);
                await clearAndSaveStore(transaction, 'cart', cart);
                await clearAndSaveStore(transaction, 'telegram', [{ id: 'main', ...telegramSettings }]);
                await clearAndSaveStore(transaction, 'max', [{ id: 'main', ...maxSettings }]);
                
                console.log('–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ IndexedDB');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ IndexedDB:', error);
                saveToLocalStorage();
            }
        }
        
        function clearAndSaveStore(transaction, storeName, data) {
            return new Promise((resolve) => {
                const store = transaction.objectStore(storeName);
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    if (data && data.length > 0) {
                        data.forEach(item => {
                            try {
                                store.add(item);
                            } catch (e) {
                                console.error('Error adding item to store:', e);
                            }
                        });
                    }
                    resolve();
                };
                
                clearRequest.onerror = () => {
                    resolve();
                };
            });
        }
        
        // ==================== LOCALSTORAGE –§–£–ù–ö–¶–ò–ò ====================
        
        function loadFromLocalStorage() {
            console.log('–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage');
            
            currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
            isAdmin = localStorage.getItem('isAdmin') === 'true';
            products = JSON.parse(localStorage.getItem('products')) || [];
            categoriesData = JSON.parse(localStorage.getItem('categoriesData')) || getDefaultCategories();
            siteSettings = JSON.parse(localStorage.getItem('siteSettings')) || getDefaultSettings();
            orders = JSON.parse(localStorage.getItem('orders')) || [];
            customers = JSON.parse(localStorage.getItem('customers')) || [];
            cart = JSON.parse(localStorage.getItem('cart')) || [];
            telegramSettings = JSON.parse(localStorage.getItem('telegramSettings')) || {};
            maxSettings = JSON.parse(localStorage.getItem('maxSettings')) || {};
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ URL –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
            checkUrlForData();
        }
        
        function saveToLocalStorage() {
            console.log('–°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage');
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('isAdmin', isAdmin);
            localStorage.setItem('products', JSON.stringify(products));
            localStorage.setItem('categoriesData', JSON.stringify(categoriesData));
            localStorage.setItem('siteSettings', JSON.stringify(siteSettings));
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('cart', JSON.stringify(cart));
            localStorage.setItem('telegramSettings', JSON.stringify(telegramSettings));
            localStorage.setItem('maxSettings', JSON.stringify(maxSettings));
        }
        
        function getDefaultCategories() {
            return [
                { 
                    name: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è', 
                    icon: 'üß¥', 
                    color1: '#667eea', 
                    color2: '#764ba2',
                    backgroundType: 'gradient',
                    backgroundImage: ''
                },
                { 
                    name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', 
                    icon: 'üì±', 
                    color1: '#f093fb', 
                    color2: '#f5576c',
                    backgroundType: 'gradient',
                    backgroundImage: ''
                },
                { 
                    name: '–û–¥–µ–∂–¥–∞', 
                    icon: 'üëï', 
                    color1: '#4facfe', 
                    color2: '#00f2fe',
                    backgroundType: 'gradient',
                    backgroundImage: ''
                }
            ];
        }
        
        function getDefaultSettings() {
            return {
                backgroundType: 'gradient',
                backgroundImage: '',
                color1: '#667eea',
                color2: '#764ba2',
                headerColor: '#2c5aa0',
                logoText: '–î–õ–Ø –°–í–û–ò–•',
                title: '–ú–∞–≥–∞–∑–∏–Ω –¥–ª—è —Å–≤–æ–∏—Ö',
                subtitle: '–≠–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –Ω–∞—à–µ–≥–æ –∫—Ä—É–≥–∞'
            };
        }
        
        // ==================== –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ß–ï–†–ï–ó URL ====================
        
        function checkUrlForData() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            
            if (dataParam) {
                try {
                    const data = JSON.parse(decodeURIComponent(dataParam));
                    importAllData(data);
                    
                    // –û—á–∏—â–∞–µ–º URL –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                    const cleanUrl = window.location.origin + window.location.pathname;
                    window.history.replaceState({}, document.title, cleanUrl);
                    
                    showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Å—Å—ã–ª–∫–∏!');
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL:', error);
                }
            }
        }
        
        function exportData() {
            const data = {
                products: products,
                categories: categoriesData,
                settings: siteSettings,
                orders: orders,
                customers: customers,
                telegram: telegramSettings,
                max: maxSettings,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = encodeURIComponent(JSON.stringify(data));
            const exportUrl = `${window.location.origin}${window.location.pathname}?data=${dataStr}`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —ç–∫—Å–ø–æ—Ä—Ç–∞
            showExportPanel(exportUrl);
        }
        
        function showExportPanel(url) {
            document.getElementById('productsPanelContent').innerHTML = `
                <h3>üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="form-group">
                    <label>–°—Å—ã–ª–∫–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö:</label>
                    <textarea class="form-control" rows="4" id="exportUrl" readonly>${url}</textarea>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="copyToClipboard('${url}')" style="width: 100%;">
                        <i class="fas fa-copy"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                    </button>
                </div>
                <div class="form-group">
                    <label>QR-–∫–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤:</label>
                    <div style="text-align: center; padding: 20px; background: white; border-radius: 10px;">
                        <div id="qrcode"></div>
                    </div>
                </div>
                <div class="form-group">
                    <button class="btn btn-success" onclick="backupData()" style="width: 100%;">
                        <i class="fas fa-download"></i> –°–∫–∞—á–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
                    </button>
                </div>
                <div class="panel-actions">
                    <button class="btn btn-danger" onclick="closePanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
            
            document.getElementById('editOverlay').style.display = 'block';
            document.getElementById('productsPanel').style.display = 'block';
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥
            QRCode.toCanvas(document.getElementById('qrcode'), url, {
                width: 200,
                margin: 1,
                color: {
                    dark: '#2c5aa0',
                    light: '#ffffff'
                }
            }, function(error) {
                if (error) console.error('QR Code error:', error);
            });
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }).catch(err => {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showNotification('‚úÖ –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }
        
        function importData() {
            document.getElementById('productsPanelContent').innerHTML = `
                <h3>üì• –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="form-group">
                    <label>–í—Å—Ç–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏:</label>
                    <input type="text" class="form-control" id="importUrl" placeholder="https://prod-torg-barnaul.ru/?data=...">
                </div>
                <div class="form-group">
                    <label>–ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏:</label>
                    <div class="file-upload" onclick="document.getElementById('backupFile').click()">
                        <i class="fas fa-file-upload"></i>
                        <p>–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .json —Ñ–∞–π–ª–∞</p>
                        <input type="file" id="backupFile" accept=".json" style="display: none;" 
                               onchange="importFromFile(this.files[0])">
                    </div>
                </div>
                <div class="panel-actions">
                    <button class="btn btn-success" onclick="importFromUrl()">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    <button class="btn btn-danger" onclick="closePanel()">–û—Ç–º–µ–Ω–∞</button>
                </div>
            `;
            
            document.getElementById('editOverlay').style.display = 'block';
            document.getElementById('productsPanel').style.display = 'block';
        }
        
        function importFromUrl() {
            const url = document.getElementById('importUrl').value.trim();
            if (!url) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏');
                return;
            }
            
            try {
                const urlObj = new URL(url);
                const dataParam = urlObj.searchParams.get('data');
                
                if (!dataParam) {
                    showNotification('‚ùå –í —Å—Å—ã–ª–∫–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                    return;
                }
                
                const data = JSON.parse(decodeURIComponent(dataParam));
                importAllData(data);
                showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                closePanel();
                
            } catch (error) {
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –¥–∞–Ω–Ω—ã—Ö');
            }
        }
        
        function importFromFile(file) {
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    importAllData(data);
                    showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ —Ñ–∞–π–ª–∞!');
                    closePanel();
                } catch (error) {
                    showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
                }
            };
            
            reader.onerror = function() {
                showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞');
            };
            
            reader.readAsText(file);
        }
        
        function importAllData(data) {
            if (data.products) products = data.products;
            if (data.categories) categoriesData = data.categories;
            if (data.settings) siteSettings = data.settings;
            if (data.orders) orders = data.orders;
            if (data.customers) customers = data.customers;
            if (data.telegram) telegramSettings = data.telegram;
            if (data.max) maxSettings = data.max;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤–æ –≤—Å–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
            saveToIndexedDB();
            saveToLocalStorage();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            applySiteSettings();
            loadCategories();
            loadProducts();
            updateCategoryFilter();
            updateCartCount();
        }
        
        function backupData() {
            const data = {
                products: products,
                categories: categoriesData,
                settings: siteSettings,
                orders: orders,
                customers: customers,
                telegram: telegramSettings,
                max: maxSettings,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `prodtorg-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('‚úÖ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∏ —Å–∫–∞—á–∞–Ω–∞!');
        }
        
        function restoreData() {
            if (confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ IndexedDB? –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã.')) {
                loadFromIndexedDB().then(() => {
                    showNotification('‚úÖ –î–∞–Ω–Ω—ã–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!');
                    initializeSite();
                });
            }
        }
        
        function syncData() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            const syncPanel = document.getElementById('syncPanel');
            syncPanel.style.display = syncPanel.style.display === 'block' ? 'none' : 'block';
        }
        
        // ==================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –°–ê–ô–¢–ê ====================
        // ... (–≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –í–°–ï —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–¥–∞, –Ω–∞—á–∏–Ω–∞—è —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
        // –í–ê–ñ–ù–û: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–¥–∞ (editProducts, openCart, –∏ —Ç.–¥.)
        
        // ==================== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ====================
        
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            document.querySelector(`.auth-tab[onclick*="${tab}"]`).classList.add('active');
            document.getElementById(`${tab}Auth`).classList.add('active');
        }
        
        function loginAsCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            
            if (!name || !phone) {
                showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
            let customer = customers.find(c => c.phone === phone);
            if (!customer) {
                customer = {
                    id: Date.now(),
                    name: name,
                    phone: phone,
                    registrationDate: new Date().toISOString()
                };
                customers.push(customer);
            }
            
            currentUser = {
                id: customer.id,
                name: name,
                phone: phone,
                role: 'customer'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('isAdmin', 'false');
            isAdmin = false;
            
            saveToIndexedDB();
            saveToLocalStorage();
            
            initializeSite();
        }
        
        function continueAsGuest() {
            currentUser = {
                id: 'guest_' + Date.now(),
                name: '–ì–æ—Å—Ç—å',
                role: 'guest'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            localStorage.setItem('isAdmin', 'false');
            isAdmin = false;
            
            initializeSite();
        }
        
        function loginAsAdmin() {
            const login = document.getElementById('adminLogin').value;
            const password = document.getElementById('adminPassword').value;
            
            if (login === 'admin' && password === '123456') {
                currentUser = {
                    id: 'admin',
                    name: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä',
                    role: 'admin'
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('isAdmin', 'true');
                isAdmin = true;
                
                showNotification('‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!');
                initializeSite();
            } else {
                showNotification('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å');
            }
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–ê–ô–¢–ê ====================
        
        function initializeSite() {
            document.getElementById('authOverlay').style.display = 'none';
            document.getElementById('mainHeader').style.display = 'block';
            document.getElementById('heroSection').style.display = 'block';
            document.getElementById('categoriesSection').style.display = 'block';
            document.getElementById('productsSection').style.display = 'block';
            document.getElementById('mainFooter').style.display = 'block';
            
            updateUserInfo();
            applySiteSettings();
            loadCategories();
            loadProducts();
            updateCategoryFilter();
            updateCartCount();
            
            if (isAdmin) {
                document.getElementById('constructorToolbar').style.display = 'block';
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤, —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ
            if (products.length === 0) {
                addSampleProducts();
            }
        }
        
        function updateUserInfo() {
            if (!currentUser) return;
            
            document.getElementById('userNameDisplay').textContent = currentUser.name;
            document.getElementById('userFullName').textContent = currentUser.name;
            document.getElementById('userRoleDisplay').textContent = isAdmin ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : currentUser.role === 'customer' ? '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å' : '–ì–æ—Å—Ç—å';
            document.getElementById('userAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
        }
        
        function applySiteSettings() {
            if (siteSettings.backgroundType === 'gradient') {
                document.body.style.background = `linear-gradient(135deg, ${siteSettings.color1}, ${siteSettings.color2})`;
            } else if (siteSettings.backgroundType === 'solid') {
                document.body.style.background = siteSettings.color1;
            } else if (siteSettings.backgroundType === 'image' && siteSettings.backgroundImage) {
                document.body.style.background = `url('${siteSettings.backgroundImage}') center/cover fixed`;
            }
            
            document.getElementById('siteLogo').innerHTML = `${siteSettings.logoText}<span>.</span>`;
            document.querySelector('.header-top').style.background = `linear-gradient(135deg, ${siteSettings.headerColor}, #1a3a6b)`;
            
            document.getElementById('siteTitle').textContent = siteSettings.title;
            document.getElementById('siteSubtitle').textContent = siteSettings.subtitle;
        }
        
        function addSampleProducts() {
            const sampleProducts = [
                {
                    id: 100,
                    name: 'FAIRY banane - 5 –ª–∏—Ç—Ä–æ–≤',
                    category: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è',
                    price: 800,
                    oldPrice: 1000,
                    quantity: 10,
                    status: 'in_stock',
                    description: '–ö–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å—Ä–µ–¥—Å—Ç–≤–æ –¥–ª—è –º—ã—Ç—å—è –ø–æ—Å—É–¥—ã',
                    image: 'https://via.placeholder.com/300x200/667eea/ffffff?text=FAIRY+5L'
                },
                {
                    id: 101,
                    name: '–°–º–∞—Ä—Ç—Ñ–æ–Ω Xiaomi',
                    category: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞',
                    price: 15000,
                    oldPrice: 18000,
                    quantity: 5,
                    status: 'in_stock',
                    description: '–°–º–∞—Ä—Ç—Ñ–æ–Ω —Å —Ö–æ—Ä–æ—à–µ–π –∫–∞–º–µ—Ä–æ–π',
                    image: 'https://via.placeholder.com/300x200/f093fb/ffffff?text=Xiaomi'
                }
            ];
            
            products = sampleProducts;
            saveToIndexedDB();
            saveToLocalStorage();
            
            loadProducts();
            updateCategoryFilter();
        }
        
        // ==================== –†–ê–ë–û–¢–ê –° –ö–ê–¢–ï–ì–û–†–ò–Ø–ú–ò ====================
        
        function loadCategories() {
            const categoriesGrid = document.getElementById('categoriesGrid');
            categoriesGrid.innerHTML = categoriesData.map(category => {
                let background = getCategoryBackground(category);
                
                return `
                    <div class="category-card" style="background: ${background}" onclick="filterByCategory('${category.name}')">
                        ${category.icon ? `<span class="category-icon">${category.icon}</span>` : ''}
                        <h3>${category.name}</h3>
                    </div>
                `;
            }).join('');
        }
        
        function getCategoryBackground(category) {
            if (category.backgroundType === 'gradient') {
                return `linear-gradient(135deg, ${category.color1}, ${category.color2})`;
            } else if (category.backgroundType === 'solid') {
                return category.color1;
            } else if (category.backgroundType === 'image') {
                return `url('${category.backgroundImage}')`;
            }
            return `linear-gradient(135deg, ${category.color1 || '#667eea'}, ${category.color2 || '#764ba2'})`;
        }
        
        // ==================== –†–ê–ë–û–¢–ê –° –¢–û–í–ê–†–ê–ú–ò ====================
        
        function loadProducts() {
            const productsGrid = document.getElementById('productsGrid');
            
            if (filteredProducts.length === 0) {
                filteredProducts = [...products];
            }
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                        <h3 style="color: var(--gray); margin-bottom: 20px;">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    </div>
                `;
                return;
            }
            
            productsGrid.innerHTML = filteredProducts.map(product => {
                const discount = product.oldPrice ? Math.round((1 - product.price / product.oldPrice) * 100) : 0;
                const statusClass = `status-${product.status.replace('_', '-')}`;
                
                return `
                    <div class="product-card">
                        ${discount > 0 ? `<div class="product-badge">-${discount}%</div>` : ''}
                        <img src="${product.image}" alt="${product.name}" class="product-image" 
                             onclick="showProductDetails(${product.id})"
                             onerror="this.src='https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=–ù–µ—Ç+–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'">
                        <div class="product-info">
                            <div class="product-category">${product.category}</div>
                            <h3 class="product-name" onclick="showProductDetails(${product.id})">${product.name}</h3>
                            <div class="product-description-short">${product.description}</div>
                            
                            <div class="product-price">
                                <span class="current-price">${product.price.toLocaleString()} ‚ÇΩ</span>
                                ${product.oldPrice ? `<span class="old-price">${product.oldPrice.toLocaleString()} ‚ÇΩ</span>` : ''}
                                ${discount > 0 ? `<span class="discount">-${discount}%</span>` : ''}
                            </div>
                            
                            <div class="product-status ${statusClass}">
                                ${getProductStatusText(product.status)}
                            </div>
                            
                            <div class="product-actions">
                                <button class="add-to-cart" onclick="addToCart(${product.id})" 
                                        ${product.status !== 'in_stock' ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i>
                                    ${product.status === 'in_stock' ? '–í –∫–æ—Ä–∑–∏–Ω—É' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}
                                </button>
                                <button class="details-btn" onclick="showProductDetails(${product.id})">
                                    <i class="fas fa-info"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function getProductStatusText(status) {
            const statuses = {
                'in_stock': '–í –Ω–∞–ª–∏—á–∏–∏',
                'out_of_stock': '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏',
                'pre_order': '–ü–æ–¥ –∑–∞–∫–∞–∑'
            };
            return statuses[status] || status;
        }
        
        function filterByCategory(category) {
            document.getElementById('categoryFilter').value = category;
            filterProducts();
        }
        
        function filterProducts() {
            const category = document.getElementById('categoryFilter').value;
            const priceRange = document.getElementById('priceFilter').value;
            
            filteredProducts = products.filter(product => {
                if (category && product.category !== category) return false;
                if (priceRange) {
                    const [min, max] = priceRange.split('-').map(Number);
                    if (product.price < min || product.price > max) return false;
                }
                return true;
            });
            
            loadProducts();
        }
        
        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            if (searchTerm.trim() === '') {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.description.toLowerCase().includes(searchTerm)
                );
            }
            
            loadProducts();
        }
        
        function sortProducts() {
            const sortBy = document.getElementById('sortBy').value;
            if (sortBy === 'price_asc') {
                filteredProducts.sort((a, b) => a.price - b.price);
            } else if (sortBy === 'price_desc') {
                filteredProducts.sort((a, b) => b.price - a.price);
            } else if (sortBy === 'name') {
                filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
            }
            loadProducts();
        }
        
        function updateCategoryFilter() {
            const categoryFilter = document.getElementById('categoryFilter');
            const allCategories = [...new Set(products.map(p => p.category))];
            
            categoryFilter.innerHTML = '<option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>' +
                allCategories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
        }
        
        // ==================== –ö–û–†–ó–ò–ù–ê ====================
        
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const existingItem = cart.find(item => item.id === productId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1,
                    cartId: Date.now()
                });
            }
            
            saveToIndexedDB();
            saveToLocalStorage();
            updateCartCount();
            showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
        }
        
        function updateCartCount() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = totalItems;
        }
        
        function openCart() {
            const modal = document.getElementById('cartModal');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: var(--gray); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--gray);">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                        <p style="color: var(--gray);">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑</p>
                    </div>
                `;
                cartTotal.textContent = '0';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}" class="cart-item-image"
                             onerror="this.src='https://via.placeholder.com/60x60/ecf0f1/7f8c8d?text=–ù–µ—Ç'">
                        <div class="cart-item-details">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-price">${item.price} ‚ÇΩ √ó ${item.quantity}</div>
                        </div>
                        <div class="cart-item-quantity">
                            <button class="quantity-btn" onclick="changeQuantity(${item.cartId}, -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span style="min-width: 20px; text-align: center;">${item.quantity}</span>
                            <button class="quantity-btn" onclick="changeQuantity(${item.cartId}, 1)">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <button class="btn btn-sm btn-danger" onclick="removeFromCart(${item.cartId})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `).join('');
                
                const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                cartTotal.textContent = total.toLocaleString();
            }
            
            modal.style.display = 'block';
        }
        
        function closeCart() {
            document.getElementById('cartModal').style.display = 'none';
        }
        
        function changeQuantity(cartId, change) {
            const item = cart.find(item => item.cartId === cartId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(cartId);
                } else {
                    saveToIndexedDB();
                    saveToLocalStorage();
                    updateCartCount();
                    openCart();
                }
            }
        }
        
        function removeFromCart(cartId) {
            cart = cart.filter(item => item.cartId !== cartId);
            saveToIndexedDB();
            saveToLocalStorage();
            updateCartCount();
            openCart();
            showNotification('üóëÔ∏è –¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
        }
        
        // ==================== –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ====================
        
        function checkout() {
            if (currentUser.role === 'guest') {
                showNotification('‚ùå –î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É');
                closeCart();
                return;
            }
            
            if (cart.length === 0) {
                showNotification('‚ùå –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('checkoutContent').innerHTML = `
                <div class="form-group">
                    <label>–ò–º—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è:</label>
                    <input type="text" class="form-control" id="orderName" 
                           value="${currentUser.name || ''}" placeholder="–í–∞—à–µ –∏–º—è">
                </div>
                
                <div class="form-group">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" class="form-control" id="orderPhone" 
                           value="${currentUser.phone || ''}" placeholder="+7 (XXX) XXX-XX-XX">
                </div>
                
                <div class="form-group">
                    <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                    <textarea class="form-control" id="orderAddress" rows="3" 
                              placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞, –ø–æ–¥—ä–µ–∑–¥, —ç—Ç–∞–∂"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</label>
                    <textarea class="form-control" id="orderComment" rows="3" 
                              placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</label>
                    <select class="form-control" id="orderDelivery">
                        <option value="delivery">–î–æ—Å—Ç–∞–≤–∫–∞</option>
                        <option value="pickup">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
                    </select>
                    <small style="color: var(--gray);">
                        <i class="fas fa-info-circle"></i> 
                        –ü—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ —Å –≤–∞–º–∏ —Å–≤—è–∂—É—Ç—Å—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
                    </small>
                </div>
                
                <div class="form-group">
                    <label>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞:</label>
                    <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">
                        ${total.toLocaleString()} ‚ÇΩ
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4><i class="fas fa-list"></i> –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</h4>
                    ${cart.map(item => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                            <span>${item.name} √ó ${item.quantity}</span>
                            <span>${(item.price * item.quantity).toLocaleString()} ‚ÇΩ</span>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-success" onclick="submitOrder()" style="flex: 1;">
                        <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                    <button class="btn btn-outline" onclick="closeCheckout()">
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            `;
            
            closeCart();
            document.getElementById('checkoutModal').style.display = 'block';
        }
        
        function closeCheckout() {
            document.getElementById('checkoutModal').style.display = 'none';
        }
        
        function submitOrder() {
            const name = document.getElementById('orderName').value.trim();
            const phone = document.getElementById('orderPhone').value.trim();
            const address = document.getElementById('orderAddress').value.trim();
            const comment = document.getElementById('orderComment').value.trim();
            const delivery = document.getElementById('orderDelivery').value;
            
            if (!name || !phone) {
                showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const order = {
                id: 'ORD-' + Date.now(),
                customerId: currentUser.id,
                customerName: name,
                customerPhone: phone,
                address: address,
                comment: comment,
                delivery: delivery,
                items: cart.map(item => ({
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity,
                    total: item.price * item.quantity
                })),
                total: total,
                status: 'new',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString()
            };
            
            orders.push(order);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            sendTelegramNotification(order);
            sendMaxNotification(order);
            
            // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
            cart = [];
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            saveToIndexedDB();
            saveToLocalStorage();
            
            updateCartCount();
            closeCheckout();
            
            showNotification('‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –° –≤–∞–º–∏ —Å–≤—è–∂—É—Ç—Å—è –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π.');
            
            // –ï—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (isAdmin) {
                showNotification(`üì¶ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑ #${order.id} –æ—Ç ${name}`);
            }
        }
        
        // ==================== –ü–†–û–§–ò–õ–¨ ====================
        
        function openProfile() {
            const userOrders = orders.filter(o => o.customerId === currentUser.id);
            const totalSpent = userOrders.reduce((sum, order) => sum + order.total, 0);
            
            document.getElementById('profileContent').innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="user-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto 15px;">
                        ${currentUser.name.charAt(0).toUpperCase()}
                    </div>
                    <h3>${currentUser.name}</h3>
                    <p style="color: var(--gray);">
                        ${isAdmin ? 'üëë –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : currentUser.role === 'customer' ? 'üë§ –ü–æ–∫—É–ø–∞—Ç–µ–ª—å' : 'üë§ –ì–æ—Å—Ç—å'}
                    </p>
                </div>
                
                <div class="form-group">
                    <label>–ò–º—è:</label>
                    <input type="text" class="form-control" value="${currentUser.name}" readonly>
                </div>
                
                ${currentUser.phone ? `
                    <div class="form-group">
                        <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                        <input type="tel" class="form-control" value="${currentUser.phone}" readonly>
                    </div>
                ` : ''}
                
                ${!isAdmin ? `
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                        <h4><i class="fas fa-chart-bar"></i> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: center; margin-top: 15px;">
                            <div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: var(--primary);">
                                    ${userOrders.length}
                                </div>
                                <div style="font-size: 0.9rem; color: var(--gray);">–ó–∞–∫–∞–∑–æ–≤</div>
                            </div>
                            <div>
                                <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent);">
                                    ${totalSpent.toLocaleString()} ‚ÇΩ
                                </div>
                                <div style="font-size: 0.9rem; color: var(--gray);">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="openOrders()" style="width: 100%;">
                            <i class="fas fa-box"></i> –ú–æ–∏ –∑–∞–∫–∞–∑—ã
                        </button>
                    </div>
                ` : ''}
            `;
            
            document.getElementById('profileModal').style.display = 'block';
        }
        
        function closeProfile() {
            document.getElementById('profileModal').style.display = 'none';
        }
        
        // ==================== –î–ï–¢–ê–õ–ò –¢–û–í–ê–†–ê ====================
        
        function showProductDetails(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            const discount = product.oldPrice ? Math.round((1 - product.price / product.oldPrice) * 100) : 0;
            
            document.getElementById('productModalTitle').textContent = product.name;
            document.getElementById('productModalContent').innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${product.image}" alt="${product.name}" 
                         style="max-width: 100%; max-height: 300px; border-radius: 10px; object-fit: cover;"
                         onerror="this.src='https://via.placeholder.com/400x300/ecf0f1/7f8c8d?text=–ù–µ—Ç+–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'">
                </div>
                
                <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                    <div>
                        <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${product.category}
                    </div>
                    <div>
                        <strong>–ö–æ–¥:</strong> #${product.id}
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>–¶–µ–Ω–∞:</strong>
                    <div style="display: flex; align-items: center; gap: 15px; margin-top: 5px;">
                        <span style="font-size: 2rem; color: var(--primary); font-weight: bold;">
                            ${product.price.toLocaleString()} ‚ÇΩ
                        </span>
                        ${product.oldPrice ? `
                            <span style="font-size: 1.2rem; color: var(--gray); text-decoration: line-through;">
                                ${product.oldPrice.toLocaleString()} ‚ÇΩ
                            </span>
                            <span style="background: var(--secondary); color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">
                                -${discount}%
                            </span>
                        ` : ''}
                    </div>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <strong>–ù–∞–ª–∏—á–∏–µ:</strong>
                    <span class="product-status status-${product.status.replace('_', '-')}" style="margin-left: 10px;">
                        ${getProductStatusText(product.status)} (${product.quantity} —à—Ç.)
                    </span>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong>
                    <p style="margin-top: 10px; line-height: 1.6; color: var(--dark);">
                        ${product.description}
                    </p>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="addToCart(${product.id}); closeProductModal();" 
                            style="flex: 1;" ${product.status !== 'in_stock' ? 'disabled' : ''}>
                        <i class="fas fa-shopping-cart"></i>
                        ${product.status === 'in_stock' ? '–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É' : '–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ'}
                    </button>
                    <button class="btn btn-outline" onclick="closeProductModal()">
                        <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                    </button>
                </div>
            `;
            
            document.getElementById('productModal').style.display = 'block';
        }
        
        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }
        
        // ==================== –ó–ê–ö–ê–ó–´ ====================
        
        function openOrders() {
            const userOrders = orders.filter(o => o.customerId === currentUser.id);
            
            document.getElementById('ordersContent').innerHTML = `
                <h4 style="margin-bottom: 20px;">
                    <i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ (${userOrders.length})
                </h4>
                
                ${userOrders.length === 0 ? `
                    <div style="text-align: center; padding: 40px;">
                        <i class="fas fa-box-open" style="font-size: 3rem; color: var(--gray); margin-bottom: 20px;"></i>
                        <h3 style="color: var(--gray);">–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</h3>
                        <p style="color: var(--gray);">–°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!</p>
                    </div>
                ` : `
                    <div class="order-list">
                        ${userOrders.map(order => `
                            <div class="order-item">
                                <div class="order-header">
                                    <div>
                                        <strong>–ó–∞–∫–∞–∑ #${order.id}</strong>
                                        <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">
                                            ${new Date(order.createdAt).toLocaleDateString('ru-RU')} 
                                            ${new Date(order.createdAt).toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'})}
                                        </div>
                                    </div>
                                    <div class="order-status status-${order.status}">
                                        ${getOrderStatusText(order.status)}
                                    </div>
                                </div>
                                
                                <div>
                                    <div><strong>–°—É–º–º–∞:</strong> ${order.total.toLocaleString()} ‚ÇΩ</div>
                                    <div><strong>–°–ø–æ—Å–æ–±:</strong> ${order.delivery === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑'}</div>
                                    ${order.address ? `<div><strong>–ê–¥—Ä–µ—Å:</strong> ${order.address}</div>` : ''}
                                </div>
                                
                                <div class="order-details">
                                    <strong>–¢–æ–≤–∞—Ä—ã:</strong>
                                    ${order.items.map(item => `
                                        <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                            <span>${item.name} √ó ${item.quantity}</span>
                                            <span>${item.total.toLocaleString()} ‚ÇΩ</span>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                ${order.comment ? `
                                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border);">
                                        <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong>
                                        <p style="margin-top: 5px; color: var(--gray);">${order.comment}</p>
                                    </div>
                                ` : ''}
                            </div>
                        `).join('')}
                    </div>
                `}
            `;
            
            document.getElementById('ordersModal').style.display = 'block';
        }
        
        function closeOrders() {
            document.getElementById('ordersModal').style.display = 'none';
        }
        
        function getOrderStatusText(status) {
            const statuses = {
                'new': 'üÜï –ù–æ–≤—ã–π',
                'processing': 'üîÑ –í –æ–±—Ä–∞–±–æ—Ç–∫–µ',
                'completed': '‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω',
                'cancelled': '‚ùå –û—Ç–º–µ–Ω–µ–Ω'
            };
            return statuses[status] || status;
        }
        
        // ==================== TELEGRAM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø ====================
        
        function sendTelegramNotification(order) {
            if (!telegramSettings.token || !telegramSettings.chatId || !telegramSettings.enabled) {
                return;
            }
            
            const message = `üÜï –ù–û–í–´–ô –ó–ê–ö–ê–ó #${order.id}\n\n` +
                  `üë§ –ö–ª–∏–µ–Ω—Ç: ${order.customerName}\n` +
                  `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${order.customerPhone}\n` +
                  `üí∞ –°—É–º–º–∞: ${order.total.toLocaleString()} ‚ÇΩ\n` +
                  `‚è∞ –í—Ä–µ–º—è: ${new Date(order.createdAt).toLocaleString('ru-RU')}`;
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            console.log('Telegram notification:', message);
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç fetch –∫ Telegram API
        }
        
        function sendMaxNotification(order) {
            // –°–∏–º—É–ª—è—Ü–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Max CRM
            console.log('Max CRM notification:', order);
        }
        
        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // ==================== –ö–û–ù–°–¢–†–£–ö–¢–û–† ====================
        
        function toggleConstructor() {
            const toolbar = document.querySelector('.constructor-toolbar');
            const editButtons = document.getElementById('editButtons');
            
            if (toolbar.classList.contains('expanded')) {
                toolbar.classList.remove('expanded');
                editButtons.style.display = 'none';
            } else {
                toolbar.classList.add('expanded');
                editButtons.style.display = 'flex';
            }
        }
        
        function editProducts() {
            document.getElementById('editOverlay').style.display = 'block';
            document.getElementById('productsPanel').style.display = 'block';
            
            document.getElementById('productsPanelContent').innerHTML = `
                <h3>üõçÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <button class="btn btn-primary" onclick="showAddProductForm()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                    <button class="btn btn-success" onclick="importData()">
                        <i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
                    </button>
                </div>
                
                <div class="form-group">
                    <label>–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–∞:</label>
                    <input type="text" class="form-control" id="productSearch" 
                           placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏..." 
                           onkeyup="searchProductsInEditor()">
                </div>
                
                <div id="productsEditorList" style="max-height: 400px; overflow-y: auto;">
                    ${products.map((product, index) => `
                        <div class="category-editor-item" id="product-${index}">
                            <div class="category-header">
                                <h4>${product.name}</h4>
                                <div>
                                    <span style="font-size: 0.9rem; color: var(--primary); font-weight: bold;">
                                        ${product.price.toLocaleString()} ‚ÇΩ
                                    </span>
                                    <button class="btn btn-sm btn-outline" onclick="showEditProductForm(${index})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteProduct(${index})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 100px 1fr; gap: 15px; align-items: start;">
                                <img src="${product.image}" alt="${product.name}" 
                                     style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;"
                                     onerror="this.src='https://via.placeholder.com/100x100/ecf0f1/7f8c8d?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
                                <div>
                                    <div><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${product.category}</div>
                                    <div><strong>–ù–∞–ª–∏—á–∏–µ:</strong> ${product.quantity} —à—Ç.</div>
                                    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${getProductStatusText(product.status)}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="panel-actions">
                    <button class="btn btn-danger" onclick="closePanel()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            `;
        }
        
        function searchProductsInEditor() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const productItems = document.querySelectorAll('.category-editor-item');
            
            productItems.forEach(item => {
                const productName = item.querySelector('h4').textContent.toLowerCase();
                if (productName.includes(searchTerm) || searchTerm === '') {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        function showAddProductForm() {
            const name = prompt('–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:');
            if (!name) return;
            
            const category = prompt('–ö–∞—Ç–µ–≥–æ—Ä–∏—è:');
            if (!category) return;
            
            const price = parseFloat(prompt('–¶–µ–Ω–∞:'));
            if (isNaN(price)) return;
            
            const newProduct = {
                id: Date.now(),
                name: name,
                category: category,
                price: price,
                quantity: 10,
                status: 'in_stock',
                description: '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞',
                image: 'https://via.placeholder.com/300x200/ecf0f1/7f8c8d?text=–ù–µ—Ç+–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è'
            };
            
            products.push(newProduct);
            saveToIndexedDB();
            saveToLocalStorage();
            loadProducts();
            updateCategoryFilter();
            
            showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω!');
        }
        
        function showEditProductForm(index) {
            const product = products[index];
            
            const newName = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ:', product.name);
            if (newName === null) return;
            
            const newPrice = parseFloat(prompt('–ù–æ–≤–∞—è —Ü–µ–Ω–∞:', product.price));
            if (isNaN(newPrice)) return;
            
            product.name = newName;
            product.price = newPrice;
            
            saveToIndexedDB();
            saveToLocalStorage();
            loadProducts();
            
            showNotification('‚úÖ –¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!');
        }
        
        function deleteProduct(index) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) {
                products.splice(index, 1);
                saveToIndexedDB();
                saveToLocalStorage();
                loadProducts();
                updateCategoryFilter();
                showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω');
            }
        }
        
        function closePanel() {
            document.getElementById('editOverlay').style.display = 'none';
            document.getElementById('productsPanel').style.display = 'none';
            document.getElementById('syncPanel').style.display = 'none';
        }
        
        // –î—Ä—É–≥–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞
        function editBackground() {
            showNotification('üé® –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ–Ω–∞ - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function editHeader() {
            showNotification('üìù –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–ø–∫–∏ - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function editCategories() {
            showNotification('üìÇ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function editOrders() {
            openOrders();
        }
        
        function editGiveaway() {
            showNotification('üéÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–º - —Ñ—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }
        
        function saveDesign() {
            saveToIndexedDB();
            saveToLocalStorage();
            showNotification('üíæ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }
        
        function logout() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('isAdmin');
                
                document.getElementById('authOverlay').style.display = 'flex';
                document.getElementById('mainHeader').style.display = 'none';
                document.getElementById('heroSection').style.display = 'none';
                document.getElementById('categoriesSection').style.display = 'none';
                document.getElementById('productsSection').style.display = 'none';
                document.getElementById('mainFooter').style.display = 'none';
                document.getElementById('constructorToolbar').style.display = 'none';
                
                showNotification('üëã –í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
            }
        }
        
        function showHelp() {
            alert('–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –º–∞–≥–∞–∑–∏–Ω–∞:\n\n' +
                  '1. –î–ª—è –ø–æ–∫—É–ø–æ–∫ - –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å\n' +
                  '2. –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞–≥–∞–∑–∏–Ω–æ–º - –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: 123456)\n' +
                  '3. –î–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –æ—Ñ–æ—Ä–º–ª—è–π—Ç–µ –∑–∞–∫–∞–∑—ã\n' +
                  '4. –î–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è"\n' +
                  '5. –í–æ–ø—Ä–æ—Å—ã: prodtorg.barnaul@gmail.com');
        }
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        
        document.addEventListener('DOMContentLoaded', async function() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
            await initDatabase();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (currentUser) {
                initializeSite();
            }
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –∏–º–µ–Ω–∏
            document.getElementById('customerName').focus();
        });
        
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        
        // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
        window.switchAuthTab = switchAuthTab;
        window.loginAsCustomer = loginAsCustomer;
        window.continueAsGuest = continueAsGuest;
        window.loginAsAdmin = loginAsAdmin;
        window.searchProducts = searchProducts;
        window.filterProducts = filterProducts;
        window.filterByCategory = filterByCategory;
        window.sortProducts = sortProducts;
        window.addToCart = addToCart;
        window.openProfile = openProfile;
        window.openCart = openCart;
        window.openOrders = openOrders;
        window.closeOrders = closeOrders;
        window.showProductDetails = showProductDetails;
        window.closeProductModal = closeProductModal;
        window.toggleConstructor = toggleConstructor;
        window.editProducts = editProducts;
        window.editBackground = editBackground;
        window.editHeader = editHeader;
        window.editCategories = editCategories;
        window.editOrders = editOrders;
        window.editGiveaway = editGiveaway;
        window.saveDesign = saveDesign;
        window.syncData = syncData;
        window.exportData = exportData;
        window.importData = importData;
        window.backupData = backupData;
        window.restoreData = restoreData;
        window.closePanel = closePanel;
        window.closeCart = closeCart;
        window.closeCheckout = closeCheckout;
        window.closeProfile = closeProfile;
        window.changeQuantity = changeQuantity;
        window.removeFromCart = removeFromCart;
        window.checkout = checkout;
        window.submitOrder = submitOrder;
        window.showHelp = showHelp;
        window.logout = logout;
    </script>
</body>
</html>
