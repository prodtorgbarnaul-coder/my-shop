<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PROD-TORG BARNAUL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #2c5aa0; --secondary: #e74c3c; --accent: #27ae60; }
        
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            min-height: 100vh;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 15px; }
        
        /* HEADER */
        header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        
        .header-main {
            padding: 15px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
        }
        
        .cart-btn {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .cart-count {
            background: var(--secondary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* –ö–ê–¢–ï–ì–û–†–ò–ò */
        .categories-section {
            padding: 100px 0 50px;
        }
        
        .section-title {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 40px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .category-card {
            background: white;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .category-card:hover {
            transform: translateY(-5px);
        }
        
        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        /* –¢–û–í–ê–†–´ */
        .products-section {
            padding: 50px 0;
            background: white;
            border-radius: 20px 20px 0 0;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 25px;
        }
        
        .product-card {
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .product-info {
            padding: 15px;
        }
        
        .product-name {
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .product-price {
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2rem;
            margin: 10px 0;
        }
        
        .add-to-cart {
            width: 100%;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        /* –ö–û–†–ó–ò–ù–ê */
        .cart-modal {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 1001;
        }
        
        .cart-modal.active {
            right: 0;
        }
        
        /* –§–û–†–ú–ê –û–§–û–†–ú–õ–ï–ù–ò–Ø */
        .checkout-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        /* –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ */
        .admin-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1002;
            display: none;
        }
        
        .admin-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –¢–ï–õ–ï–ì–†–ê–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–ï */
        .telegram-notification {
            background: #0088cc;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header>
        <div class="container">
            <div class="header-main">
                <div class="logo">PROD-TORG BARNAUL</div>
                <div class="cart-btn" onclick="openCart()">
                    <i class="fas fa-shopping-cart"></i>
                    –ö–æ—Ä–∑–∏–Ω–∞ <span class="cart-count" id="cartCount">0</span>
                </div>
            </div>
        </div>
    </header>

    <!-- –ö–ê–¢–ï–ì–û–†–ò–ò -->
    <section class="categories-section">
        <div class="container">
            <h2 class="section-title">–ù–ê–®–ò –ö–ê–¢–ï–ì–û–†–ò–ò</h2>
            <div class="categories-grid" id="categoriesGrid">
                <!-- –ó–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </section>

    <!-- –¢–û–í–ê–†–´ -->
    <section class="products-section">
        <div class="container">
            <h2 class="section-title" style="color: var(--primary);">–ù–ê–®–ò –¢–û–í–ê–†–´</h2>
            <div class="products-grid" id="productsGrid">
                <!-- –ó–∞–≥—Ä—É–∑—è—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </section>

    <!-- –ö–û–†–ó–ò–ù–ê -->
    <div class="cart-modal" id="cartModal">
        <div style="padding: 20px; height: 100%; display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">üõí –ö–æ—Ä–∑–∏–Ω–∞</h3>
                <button onclick="closeCart()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            
            <div id="cartItems" style="flex: 1; overflow-y: auto;">
                <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
            </div>
            
            <div style="margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px;">
                <div style="display: flex; justify-content: space-between; font-size: 1.2rem; font-weight: bold;">
                    <span>–ò—Ç–æ–≥–æ:</span>
                    <span id="cartTotal">0 ‚ÇΩ</span>
                </div>
                
                <!-- –§–æ—Ä–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ -->
                <div id="checkoutSection" style="display: none; margin-top: 20px;">
                    <h4>üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h4>
                    <input type="text" id="customerName" class="form-input" placeholder="–í–∞—à–µ –∏–º—è" required>
                    <input type="tel" id="customerPhone" class="form-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω +7 (XXX) XXX-XX-XX" required>
                    <textarea id="customerAddress" class="form-input" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–∞)" rows="3"></textarea>
                    <textarea id="orderComment" class="form-input" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É" rows="2"></textarea>
                    
                    <button onclick="submitOrder()" style="width: 100%; margin-top: 15px; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                </div>
                
                <button onclick="showCheckoutForm()" id="checkoutBtn" style="width: 100%; margin-top: 20px; padding: 15px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    <i class="fas fa-shopping-bag"></i> –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                </button>
                
                <button onclick="closeCart()" style="width: 100%; margin-top: 10px; padding: 10px; background: #eee; border: none; border-radius: 8px; cursor: pointer;">
                    –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏
                </button>
            </div>
        </div>
    </div>

    <!-- –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ -->
    <div class="admin-panel" id="adminPanel">
        <button class="admin-btn" onclick="openAdminMenu()">
            <i class="fas fa-cog"></i> –ê–¥–º–∏–Ω
        </button>
        
        <div id="adminMenu" style="display: none; position: absolute; bottom: 70px; right: 0; background: white; border-radius: 10px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); min-width: 200px;">
            <button onclick="importCSV()" style="width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 5px; margin-bottom: 10px; cursor: pointer;">
                <i class="fas fa-file-import"></i> –ò–º–ø–æ—Ä—Ç CSV
            </button>
            <button onclick="viewOrders()" style="width: 100%; padding: 10px; background: var(--accent); color: white; border: none; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-clipboard-list"></i> –ó–∞–∫–∞–∑—ã (<span id="ordersCount">0</span>)
            </button>
        </div>
    </div>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –ó–ê–ö–ê–ó–û–í -->
    <div id="ordersModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1003; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 15px; padding: 30px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>üìã –ó–∞–∫–∞–∑—ã</h3>
                <button onclick="closeOrders()" style="background: none; border: none; font-size: 24px; cursor: pointer;">√ó</button>
            </div>
            <div id="ordersList">
                <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
            </div>
        </div>
    </div>

    <input type="file" id="csvFile" accept=".csv" style="display: none;">

<script>
// ==================== –ö–û–ù–°–¢–ê–ù–¢–´ ====================

// –í–ê–® –¢–ï–õ–ï–ì–†–ê–ú –ë–û–¢ –î–õ–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–ô
const TELEGRAM_CONFIG = {
    botToken: '–í–ê–®_BOT_TOKEN', // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ç–æ–∫–µ–Ω
    chatId: '–í–ê–®_CHAT_ID'      // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à chat_id
};

// –í–ê–®–ò –ö–ê–¢–ï–ì–û–†–ò–ò
const categories = [
    { name: '–ë—ã—Ç–æ–≤–∞—è —Ö–∏–º–∏—è', icon: 'üß¥', color: '#667eea' },
    { name: '–ü–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ', icon: 'üõèÔ∏è', color: '#ff9a9e' },
    { name: '–†—ã–±–∞ –∏ –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã', icon: 'üêü', color: '#4facfe' },
    { name: '–ú—è—Å–æ –∏ –ø—Ç–∏—Ü–∞', icon: 'üçó', color: '#f093fb' },
    { name: '–ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è', icon: 'üç∞', color: '#f6d365' },
    { name: '–ú–æ–ª–æ—á–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã', icon: 'ü•õ', color: '#a1c4fd' },
    { name: '–ú–∞–Ω–≥–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã –∏ –º–∞–Ω–≥–∞–ª—ã', icon: 'üî•', color: '#ffecd2' }
];

// ==================== –û–°–ù–û–í–ù–´–ï –î–ê–ù–ù–´–ï ====================
let products = JSON.parse(localStorage.getItem('products')) || [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];
let orders = JSON.parse(localStorage.getItem('orders')) || [];
let isAdmin = false;

// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ —ç—Ç–æ
    checkAdmin();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    loadCategories();
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã
    loadProducts();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–æ—Ä–∑–∏–Ω—ã
    updateCartCount();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–∫–∞–∑–æ–≤
    updateOrdersCount();
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ –ø–æ URL –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–º—É —Ç–æ–∫–µ–Ω—É
function checkAdmin() {
    const urlParams = new URLSearchParams(window.location.search);
    const adminToken = urlParams.get('admin') || localStorage.getItem('adminToken');
    
    if (adminToken === 'prod2024' || adminToken === '7533606') {
        isAdmin = true;
        localStorage.setItem('adminToken', adminToken);
        document.getElementById('adminPanel').style.display = 'block';
        showNotification('üëë –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
    }
}

// ==================== –ö–ê–¢–ï–ì–û–†–ò–ò ====================
function loadCategories() {
    const categoriesGrid = document.getElementById('categoriesGrid');
    categoriesGrid.innerHTML = categories.map(cat => `
        <div class="category-card" onclick="filterByCategory('${cat.name}')" style="border-top: 5px solid ${cat.color};">
            <div class="category-icon">${cat.icon}</div>
            <h3>${cat.name}</h3>
        </div>
    `).join('');
}

function filterByCategory(category) {
    const filteredProducts = products.filter(p => p.category === category);
    displayProducts(filteredProducts);
    
    document.querySelector('.products-section').scrollIntoView({ behavior: 'smooth' });
}

// ==================== –¢–û–í–ê–†–´ ====================
function loadProducts() {
    const productsGrid = document.getElementById('productsGrid');
    
    if (products.length === 0) {
        productsGrid.innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <h3 style="color: #666;">–¢–æ–≤–∞—Ä—ã –ø–æ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã</h3>
                ${isAdmin ? 
                    '<p style="margin-top: 10px; color: var(--primary);">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∞ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ CSV</p>' : 
                    '<p>–ó–∞—Ö–æ–¥–∏—Ç–µ –ø–æ–∑–∂–µ</p>'
                }
            </div>
        `;
        return;
    }
    
    displayProducts(products);
}

function displayProducts(productList) {
    const productsGrid = document.getElementById('productsGrid');
    
    productsGrid.innerHTML = productList.map(product => `
        <div class="product-card">
            <img src="${product.image || 'https://via.placeholder.com/300x200/eee/666?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'}" 
                 alt="${product.name}" 
                 class="product-image"
                 onerror="this.src='https://via.placeholder.com/300x200/eee/666?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
            <div class="product-info">
                <div style="font-size: 0.9rem; color: #666; margin-bottom: 5px;">${product.category}</div>
                <div class="product-name">${product.name}</div>
                <div style="color: #666; font-size: 0.9rem; margin: 10px 0; height: 40px; overflow: hidden;">
                    ${product.description || '–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞'}
                </div>
                <div class="product-price">${product.price.toLocaleString()} ‚ÇΩ</div>
                ${(product.quantity > 0 && product.status !== 'out_of_stock') ? 
                    `<button class="add-to-cart" onclick="addToCart('${product.id}')">
                        <i class="fas fa-cart-plus"></i> –í –∫–æ—Ä–∑–∏–Ω—É
                    </button>` :
                    `<button class="add-to-cart" style="background: #999;" disabled>
                        <i class="fas fa-times"></i> –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
                    </button>`
                }
            </div>
        </div>
    `).join('');
}

// ==================== –ö–û–†–ó–ò–ù–ê ====================
function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ
    if (product.quantity <= 0 || product.status === 'out_of_stock') {
        showNotification('‚ùå –¢–æ–≤–∞—Ä –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
        return;
    }
    
    const existing = cart.find(item => item.id === productId);
    if (existing) {
        existing.quantity += 1;
    } else {
        cart.push({
            ...product,
            quantity: 1,
            cartId: Date.now()
        });
    }
    
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
    showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!');
}

function updateCartCount() {
    const total = cart.reduce((sum, item) => sum + item.quantity, 0);
    document.getElementById('cartCount').textContent = total;
}

function openCart() {
    document.getElementById('cartModal').classList.add('active');
    updateCartDisplay();
}

function closeCart() {
    document.getElementById('cartModal').classList.remove('active');
    // –°–∫—Ä—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
    document.getElementById('checkoutSection').style.display = 'none';
    document.getElementById('checkoutBtn').style.display = 'block';
}

function updateCartDisplay() {
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');
    
    if (cart.length === 0) {
        cartItems.innerHTML = '<p style="text-align: center; color: #666; padding: 20px;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>';
        cartTotal.textContent = '0 ‚ÇΩ';
        document.getElementById('checkoutBtn').style.display = 'none';
        return;
    }
    
    document.getElementById('checkoutBtn').style.display = 'block';
    
    cartItems.innerHTML = cart.map(item => `
        <div style="display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee;">
            <img src="${item.image || 'https://via.placeholder.com/50x50/eee/666'}" 
                 style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; margin-right: 15px;">
            <div style="flex: 1;">
                <div style="font-weight: bold;">${item.name}</div>
                <div style="color: #666; font-size: 0.9rem;">${item.price.toLocaleString()} ‚ÇΩ √ó ${item.quantity}</div>
            </div>
            <div style="font-weight: bold; margin-right: 15px;">
                ${(item.price * item.quantity).toLocaleString()} ‚ÇΩ
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <button onclick="updateCartQuantity('${item.cartId}', -1)" 
                        style="background: #ddd; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold;">
                    -
                </button>
                <span>${item.quantity}</span>
                <button onclick="updateCartQuantity('${item.cartId}', 1)" 
                        style="background: #ddd; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-weight: bold;">
                    +
                </button>
            </div>
        </div>
    `).join('');
    
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    cartTotal.textContent = `${total.toLocaleString()} ‚ÇΩ`;
}

function updateCartQuantity(cartId, change) {
    const item = cart.find(item => item.cartId == cartId);
    if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
            cart = cart.filter(i => i.cartId != cartId);
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        updateCartDisplay();
    }
}

function showCheckoutForm() {
    document.getElementById('checkoutSection').style.display = 'block';
    document.getElementById('checkoutBtn').style.display = 'none';
}

// ==================== –û–§–û–†–ú–õ–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê ====================
function submitOrder() {
    const name = document.getElementById('customerName').value.trim();
    const phone = document.getElementById('customerPhone').value.trim();
    const address = document.getElementById('customerAddress').value.trim();
    const comment = document.getElementById('orderComment').value.trim();
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!name || !phone) {
        showNotification('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
        return;
    }
    
    if (phone.length < 10) {
        showNotification('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞');
        return;
    }
    
    if (cart.length === 0) {
        showNotification('‚ùå –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞');
        return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
    const order = {
        id: 'ORD-' + Date.now(),
        date: new Date().toLocaleString('ru-RU'),
        customer: { name, phone, address, comment },
        items: [...cart],
        total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
        status: 'new',
        createdAt: new Date().toISOString()
    };
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑
    orders.unshift(order); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–∞—á–∞–ª–æ
    localStorage.setItem('orders', JSON.stringify(orders));
    
    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart = [];
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCount();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∑–∞–∫–∞–∑–æ–≤
    updateOrdersCount();
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
    sendTelegramNotification(order);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    showNotification(`‚úÖ –ó–∞–∫–∞–∑ #${order.id} –æ—Ñ–æ—Ä–º–ª–µ–Ω!`);
    
    // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    setTimeout(() => {
        closeCart();
        document.getElementById('customerName').value = '';
        document.getElementById('customerPhone').value = '';
        document.getElementById('customerAddress').value = '';
        document.getElementById('orderComment').value = '';
        document.getElementById('checkoutSection').style.display = 'none';
        document.getElementById('checkoutBtn').style.display = 'block';
    }, 1500);
}

// ==================== –¢–ï–õ–ï–ì–†–ê–ú –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
async function sendTelegramNotification(order) {
    try {
        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        const message = `
üõí *–ù–û–í–´–ô –ó–ê–ö–ê–ó #${order.id}*
üìÖ *–î–∞—Ç–∞:* ${order.date}
üë§ *–ö–ª–∏–µ–Ω—Ç:* ${order.customer.name}
üìû *–¢–µ–ª–µ—Ñ–æ–Ω:* ${order.customer.phone}
${order.customer.address ? `üè† *–ê–¥—Ä–µ—Å:* ${order.customer.address}\n` : ''}
${order.customer.comment ? `üí¨ *–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:* ${order.customer.comment}\n` : ''}
üí∞ *–°—É–º–º–∞:* ${order.total.toLocaleString()} ‚ÇΩ

*–¢–æ–≤–∞—Ä—ã:*
${order.items.map(item => `‚Ä¢ ${item.name} (${item.category}) - ${item.quantity} √ó ${item.price.toLocaleString()} ‚ÇΩ = ${(item.price * item.quantity).toLocaleString()} ‚ÇΩ`).join('\n')}
        `.trim();
        
        // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –±–æ—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º
        if (TELEGRAM_CONFIG.botToken !== '–í–ê–®_BOT_TOKEN' && TELEGRAM_CONFIG.chatId !== '–í–ê–®_CHAT_ID') {
            const url = `https://api.telegram.org/bot${TELEGRAM_CONFIG.botToken}/sendMessage`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CONFIG.chatId,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });
            
            if (response.ok) {
                console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram');
            }
        } else {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∞–¥–º–∏–Ω–∞
            showNotification('üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ Telegram (—Å–∏–º—É–ª—è—Ü–∏—è)');
            console.log('Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ:', message);
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', error);
    }
}

// ==================== –ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨ ====================
function openAdminMenu() {
    const menu = document.getElementById('adminMenu');
    menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
}

function importCSV() {
    document.getElementById('csvFile').click();
    document.getElementById('adminMenu').style.display = 'none';
}

function viewOrders() {
    document.getElementById('ordersModal').style.display = 'flex';
    loadOrdersList();
    document.getElementById('adminMenu').style.display = 'none';
}

function closeOrders() {
    document.getElementById('ordersModal').style.display = 'none';
}

function updateOrdersCount() {
    const newOrders = orders.filter(o => o.status === 'new').length;
    document.getElementById('ordersCount').textContent = newOrders;
}

function loadOrdersList() {
    const ordersList = document.getElementById('ordersList');
    
    if (orders.length === 0) {
        ordersList.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
        return;
    }
    
    ordersList.innerHTML = orders.map(order => `
        <div style="border: 1px solid #ddd; border-radius: 10px; padding: 20px; margin-bottom: 15px; ${order.status === 'new' ? 'border-left: 4px solid var(--accent);' : ''}">
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <h4 style="margin: 0 0 10px 0;">–ó–∞–∫–∞–∑ #${order.id}</h4>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">
                        <i class="far fa-calendar"></i> ${order.date}
                    </div>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 5px;">
                        <i class="far fa-user"></i> ${order.customer.name}
                    </div>
                    <div style="color: #666; font-size: 0.9rem; margin-bottom: 10px;">
                        <i class="fas fa-phone"></i> ${order.customer.phone}
                    </div>
                </div>
                <div>
                    <span style="background: ${order.status === 'new' ? '#d4edda' : order.status === 'processing' ? '#fff3cd' : '#d1ecf1'}; 
                            color: ${order.status === 'new' ? '#155724' : order.status === 'processing' ? '#856404' : '#0c5460'}; 
                            padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                        ${order.status === 'new' ? '–ù–æ–≤—ã–π' : order.status === 'processing' ? '–í —Ä–∞–±–æ—Ç–µ' : '–ó–∞–≤–µ—Ä—à–µ–Ω'}
                    </span>
                </div>
            </div>
            
            ${order.customer.address ? `
                <div style="margin: 10px 0; font-size: 0.9rem;">
                    <strong>–ê–¥—Ä–µ—Å:</strong> ${order.customer.address}
                </div>
            ` : ''}
            
            ${order.customer.comment ? `
                <div style="margin: 10px 0; font-size: 0.9rem;">
                    <strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> ${order.customer.comment}
                </div>
            ` : ''}
            
            <div style="margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <strong>–¢–æ–≤–∞—Ä—ã:</strong>
                ${order.items.map(item => `
                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; font-size: 0.9rem;">
                        <span>${item.name} √ó ${item.quantity}</span>
                        <span>${(item.price * item.quantity).toLocaleString()} ‚ÇΩ</span>
                    </div>
                `).join('')}
                <div style="display: flex; justify-content: space-between; padding: 10px 0 0 0; font-weight: bold; font-size: 1.1rem;">
                    <span>–ò—Ç–æ–≥–æ:</span>
                    <span>${order.total.toLocaleString()} ‚ÇΩ</span>
                </div>
            </div>
            
            ${order.status === 'new' ? `
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="updateOrderStatus('${order.id}', 'processing')" 
                            style="background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                        <i class="fas fa-play"></i> –í —Ä–∞–±–æ—Ç—É
                    </button>
                    <button onclick="callCustomer('${order.customer.phone}', '${order.customer.name}')" 
                            style="background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                        <i class="fas fa-phone"></i> –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                    </button>
                </div>
            ` : ''}
            
            ${order.status === 'processing' ? `
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button onclick="updateOrderStatus('${order.id}', 'completed')" 
                            style="background: var(--accent); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.9rem;">
                        <i class="fas fa-check"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å
                    </button>
                </div>
            ` : ''}
        </div>
    `).join('');
}

function updateOrderStatus(orderId, newStatus) {
    const order = orders.find(o => o.id === orderId);
    if (order) {
        order.status = newStatus;
        order.updatedAt = new Date().toISOString();
        localStorage.setItem('orders', JSON.stringify(orders));
        loadOrdersList();
        updateOrdersCount();
        showNotification(`‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ #${orderId} –æ–±–Ω–æ–≤–ª–µ–Ω`);
    }
}

function callCustomer(phone, name) {
    showNotification(`üìû –ó–≤–æ–Ω–æ–∫ –∫–ª–∏–µ–Ω—Ç—É: ${name} - ${phone}`);
    window.open(`tel:${phone.replace(/\D/g, '')}`, '_blank');
}

// ==================== –ò–ú–ü–û–†–¢ CSV ====================
document.getElementById('csvFile').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const csvData = e.target.result;
            const lines = csvData.split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            
            const newProducts = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = lines[i].split(',').map(v => v.trim());
                const product = {};
                
                headers.forEach((header, index) => {
                    product[header] = values[index] || '';
                });
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const newProduct = {
                    id: product.id || 'PROD-' + Date.now() + i,
                    name: product.name || product.–Ω–∞–∑–≤–∞–Ω–∏–µ || '–¢–æ–≤–∞—Ä',
                    category: product.category || product.–∫–∞—Ç–µ–≥–æ—Ä–∏—è || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏',
                    price: parseInt(product.price || product.—Ü–µ–Ω–∞ || 0),
                    quantity: parseInt(product.quantity || product.–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ || 0),
                    status: (product.status || 'in_stock').toLowerCase(),
                    description: product.description || product.–æ–ø–∏—Å–∞–Ω–∏–µ || '',
                    image: product.image_url || product.image || product['—Å—Å—ã–ª–∫–∞_–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ'] || ''
                };
                
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º URL PostImage –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                if (newProduct.image.includes('postimg.cc') && !newProduct.image.startsWith('https://i.postimg.cc')) {
                    newProduct.image = newProduct.image.replace('postimg.cc', 'i.postimg.cc');
                }
                
                newProducts.push(newProduct);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã
            products = [...products, ...newProducts];
            localStorage.setItem('products', JSON.stringify(products));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            loadProducts();
            showNotification(`‚úÖ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${newProducts.length} —Ç–æ–≤–∞—Ä–æ–≤`);
            
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:', error);
            showNotification('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ CSV');
        }
    };
    
    reader.readAsText(file, 'UTF-8');
});

// ==================== –£–¢–ò–õ–ò–¢–´ ====================
function showNotification(text) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerHTML = text;
    document.body.appendChild(notification);
    
    setTimeout(() => notification.remove(), 3000);
}

// ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
window.filterByCategory = filterByCategory;
window.addToCart = addToCart;
window.openCart = openCart;
window.closeCart = closeCart;
window.showCheckoutForm = showCheckoutForm;
window.submitOrder = submitOrder;
window.updateCartQuantity = updateCartQuantity;
window.importCSV = importCSV;
window.openAdminMenu = openAdminMenu;
window.viewOrders = viewOrders;
window.closeOrders = closeOrders;
window.updateOrderStatus = updateOrderStatus;
window.callCustomer = callCustomer;
</script>
</body>
</html>
